System.register([],(function(t,e){"use strict";return{execute:function(){var n=document.createElement("style");n.textContent='html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}:focus{outline:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration{-webkit-appearance:none;-moz-appearance:none}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}textarea{overflow:auto;vertical-align:top;resize:vertical}audio,canvas,video{display:inline-block;*display: inline;*zoom: 1;max-width:100%}audio:not([controls]){display:none;height:0}[hidden]{display:none}html{font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a:focus{outline:thin dotted}a:active,a:hover{outline:0}img{border:0;-ms-interpolation-mode:bicubic}figure{margin:0}form{margin:0}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0;white-space:normal;*margin-left: -7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align: middle}button,input{line-height:normal}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer;*overflow: visible}button[disabled],html input[disabled]{cursor:default}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0;*height: 13px;*width: 13px}input[type=search]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}html,button,input,select,textarea{color:#222}::-moz-selection{background:#b3d4fc;text-shadow:none}::selection{background:#b3d4fc;text-shadow:none}img{vertical-align:middle}fieldset{border:0;margin:0;padding:0}textarea{resize:vertical}.chromeframe{margin:.2em 0;background:#ccc;color:#000;padding:.2em 0}\n',document.head.appendChild(n);const r=function(t,e,n){let r=Promise.resolve();return r.then((()=>t())).catch((t=>{const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}))};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s,o={exports:{}},a="object"==typeof Reflect?Reflect:null,c=a&&"function"==typeof a.apply?a.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};s=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var u=Number.isNaN||function(t){return t!=t};function l(){l.init.call(this)}o.exports=l,o.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}w(t,e,s,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&w(t,"error",e,n)}(t,i,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var h=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function f(t){return void 0===t._maxListeners?l.defaultMaxListeners:t._maxListeners}function p(t,e,n,r){var i,s,o,a;if(d(n),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),void 0===o)o=s[e]=n,++t._eventsCount;else if("function"==typeof o?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=f(t))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return t}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=g.bind(r);return i.listener=n,r.wrapFn=i,i}function b(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):m(i,i.length)}function v(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function w(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||u(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[t];if(void 0===a)return!1;if("function"==typeof a)c(a,this,e);else{var u=a.length,l=m(a,u);for(n=0;n<u;++n)c(l[n],this,e)}return!0},l.prototype.addListener=function(t,e){return p(this,t,e,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(t,e){return p(this,t,e,!0)},l.prototype.once=function(t,e){return d(e),this.on(t,y(this,t,e)),this},l.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,y(this,t,e)),this},l.prototype.removeListener=function(t,e){var n,r,i,s,o;if(d(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},l.prototype.listeners=function(t){return b(this,t,!0)},l.prototype.rawListeners=function(t){return b(this,t,!1)},l.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},l.prototype.listenerCount=v,l.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};var j=o.exports;const _=i(j);var O="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,D=O||S||Function("return this")(),A=D.Symbol,M=Object.prototype,$=M.hasOwnProperty,E=M.toString,C=A?A.toStringTag:void 0,I=Object.prototype.toString,L="[object Null]",P="[object Undefined]",k=A?A.toStringTag:void 0;function x(t){return null==t?void 0===t?P:L:k&&k in Object(t)?function(t){var e=$.call(t,C),n=t[C];try{t[C]=void 0;var r=!0}catch(s){}var i=E.call(t);return r&&(e?t[C]=n:delete t[C]),i}(t):function(t){return I.call(t)}(t)}function T(t){return null!=t&&"object"==typeof t}var R="[object Symbol]";function N(t){return"symbol"==typeof t||T(t)&&x(t)==R}var z=Array.isArray,U=1/0,W=A?A.prototype:void 0,F=W?W.toString:void 0;function V(t){if("string"==typeof t)return t;if(z(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}(t,V)+"";if(N(t))return F?F.call(t):"";var e=t+"";return"0"==e&&1/t==-U?"-0":e}function q(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var B="[object AsyncFunction]",H="[object Function]",Q="[object GeneratorFunction]",G="[object Proxy]";function Y(t){if(!q(t))return!1;var e=x(t);return e==H||e==Q||e==B||e==G}var J,Z=D["__core-js_shared__"],K=(J=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"",X=Function.prototype.toString;function tt(t){if(null!=t){try{return X.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var et=/^\[object .+?Constructor\]$/,nt=Function.prototype,rt=Object.prototype,it=nt.toString,st=rt.hasOwnProperty,ot=RegExp("^"+it.call(st).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function at(t){return!(!q(t)||(e=t,K&&K in e))&&(Y(t)?ot:et).test(tt(t));var e}function ct(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return at(n)?n:void 0}var ut=ct(D,"WeakMap"),lt=Object.create,ht=function(){function t(){}return function(e){if(!q(e))return{};if(lt)return lt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),dt=function(){try{var t=ct(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),ft=9007199254740991,pt=/^(?:0|[1-9]\d*)$/;function gt(t,e){var n=typeof t;return!!(e=null==e?ft:e)&&("number"==n||"symbol"!=n&&pt.test(t))&&t>-1&&t%1==0&&t<e}function yt(t,e,n){"__proto__"==e&&dt?dt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function bt(t,e){return t===e||t!=t&&e!=e}var vt=Object.prototype.hasOwnProperty;function mt(t,e,n){var r=t[e];vt.call(t,e)&&bt(r,n)&&(void 0!==n||e in t)||yt(t,e,n)}function wt(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;void 0===c&&(c=t[a]),i?yt(n,a,c):mt(n,a,c)}return n}var jt=9007199254740991;function _t(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=jt}function Ot(t){return null!=t&&_t(t.length)&&!Y(t)}var St=Object.prototype;function Dt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||St)}function At(t){return T(t)&&"[object Arguments]"==x(t)}var Mt=Object.prototype,$t=Mt.hasOwnProperty,Et=Mt.propertyIsEnumerable,Ct=At(function(){return arguments}())?At:function(t){return T(t)&&$t.call(t,"callee")&&!Et.call(t,"callee")},It="object"==typeof t&&t&&!t.nodeType&&t,Lt=It&&"object"==typeof e&&e&&!e.nodeType&&e,Pt=Lt&&Lt.exports===It?D.Buffer:void 0,kt=(Pt?Pt.isBuffer:void 0)||function(){return!1},xt={};function Tt(t){return function(e){return t(e)}}xt["[object Float32Array]"]=xt["[object Float64Array]"]=xt["[object Int8Array]"]=xt["[object Int16Array]"]=xt["[object Int32Array]"]=xt["[object Uint8Array]"]=xt["[object Uint8ClampedArray]"]=xt["[object Uint16Array]"]=xt["[object Uint32Array]"]=!0,xt["[object Arguments]"]=xt["[object Array]"]=xt["[object ArrayBuffer]"]=xt["[object Boolean]"]=xt["[object DataView]"]=xt["[object Date]"]=xt["[object Error]"]=xt["[object Function]"]=xt["[object Map]"]=xt["[object Number]"]=xt["[object Object]"]=xt["[object RegExp]"]=xt["[object Set]"]=xt["[object String]"]=xt["[object WeakMap]"]=!1;var Rt="object"==typeof t&&t&&!t.nodeType&&t,Nt=Rt&&"object"==typeof e&&e&&!e.nodeType&&e,zt=Nt&&Nt.exports===Rt&&O.process,Ut=function(){try{var t=Nt&&Nt.require&&Nt.require("util").types;return t||zt&&zt.binding&&zt.binding("util")}catch(e){}}(),Wt=Ut&&Ut.isTypedArray,Ft=Wt?Tt(Wt):function(t){return T(t)&&_t(t.length)&&!!xt[x(t)]},Vt=Object.prototype.hasOwnProperty;function qt(t,e){var n=z(t),r=!n&&Ct(t),i=!n&&!r&&kt(t),s=!n&&!r&&!i&&Ft(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!Vt.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gt(u,c))||a.push(u);return a}function Bt(t,e){return function(n){return t(e(n))}}var Ht=Bt(Object.keys,Object),Qt=Object.prototype.hasOwnProperty;function Gt(t){if(!Dt(t))return Ht(t);var e=[];for(var n in Object(t))Qt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Yt(t){return Ot(t)?qt(t):Gt(t)}var Jt=Object.prototype.hasOwnProperty;function Zt(t){if(!q(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Dt(t),n=[];for(var r in t)("constructor"!=r||!e&&Jt.call(t,r))&&n.push(r);return n}function Kt(t){return Ot(t)?qt(t,!0):Zt(t)}var Xt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,te=/^\w*$/,ee=ct(Object,"create"),ne=Object.prototype.hasOwnProperty,re=Object.prototype.hasOwnProperty;function ie(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function se(t,e){for(var n=t.length;n--;)if(bt(t[n][0],e))return n;return-1}ie.prototype.clear=function(){this.__data__=ee?ee(null):{},this.size=0},ie.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ie.prototype.get=function(t){var e=this.__data__;if(ee){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ne.call(e,t)?e[t]:void 0},ie.prototype.has=function(t){var e=this.__data__;return ee?void 0!==e[t]:re.call(e,t)},ie.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ee&&void 0===e?"__lodash_hash_undefined__":e,this};var oe=Array.prototype.splice;function ae(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ae.prototype.clear=function(){this.__data__=[],this.size=0},ae.prototype.delete=function(t){var e=this.__data__,n=se(e,t);return!(n<0||(n==e.length-1?e.pop():oe.call(e,n,1),--this.size,0))},ae.prototype.get=function(t){var e=this.__data__,n=se(e,t);return n<0?void 0:e[n][1]},ae.prototype.has=function(t){return se(this.__data__,t)>-1},ae.prototype.set=function(t,e){var n=this.__data__,r=se(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var ce=ct(D,"Map");function ue(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function le(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}le.prototype.clear=function(){this.size=0,this.__data__={hash:new ie,map:new(ce||ae),string:new ie}},le.prototype.delete=function(t){var e=ue(this,t).delete(t);return this.size-=e?1:0,e},le.prototype.get=function(t){return ue(this,t).get(t)},le.prototype.has=function(t){return ue(this,t).has(t)},le.prototype.set=function(t,e){var n=ue(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var he="Expected a function";function de(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(he);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(de.Cache||le),n}de.Cache=le;var fe,pe,ge,ye=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,be=/\\(\\)?/g,ve=(fe=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(ye,(function(t,n,r,i){e.push(r?i.replace(be,"$1"):n||t)})),e},pe=de(fe,(function(t){return 500===ge.size&&ge.clear(),t})),ge=pe.cache,pe);function me(t,e){return z(t)?t:function(t,e){if(z(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!N(t))||te.test(t)||!Xt.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:ve(function(t){return null==t?"":V(t)}(t))}var we=1/0;function je(t){if("string"==typeof t||N(t))return t;var e=t+"";return"0"==e&&1/t==-we?"-0":e}function _e(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Oe=Bt(Object.getPrototypeOf,Object);function Se(t){var e=this.__data__=new ae(t);this.size=e.size}Se.prototype.clear=function(){this.__data__=new ae,this.size=0},Se.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Se.prototype.get=function(t){return this.__data__.get(t)},Se.prototype.has=function(t){return this.__data__.has(t)},Se.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ae){var r=n.__data__;if(!ce||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new le(r)}return n.set(t,e),this.size=n.size,this};var De="object"==typeof t&&t&&!t.nodeType&&t,Ae=De&&"object"==typeof e&&e&&!e.nodeType&&e,Me=Ae&&Ae.exports===De?D.Buffer:void 0,$e=Me?Me.allocUnsafe:void 0;function Ee(){return[]}var Ce=Object.prototype.propertyIsEnumerable,Ie=Object.getOwnPropertySymbols,Le=Ie?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}(Ie(t),(function(e){return Ce.call(t,e)})))}:Ee,Pe=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)_e(e,Le(t)),t=Oe(t);return e}:Ee;function ke(t,e,n){var r=e(t);return z(t)?r:_e(r,n(t))}function xe(t){return ke(t,Yt,Le)}function Te(t){return ke(t,Kt,Pe)}var Re=ct(D,"DataView"),Ne=ct(D,"Promise"),ze=ct(D,"Set"),Ue="[object Map]",We="[object Promise]",Fe="[object Set]",Ve="[object WeakMap]",qe="[object DataView]",Be=tt(Re),He=tt(ce),Qe=tt(Ne),Ge=tt(ze),Ye=tt(ut),Je=x;(Re&&Je(new Re(new ArrayBuffer(1)))!=qe||ce&&Je(new ce)!=Ue||Ne&&Je(Ne.resolve())!=We||ze&&Je(new ze)!=Fe||ut&&Je(new ut)!=Ve)&&(Je=function(t){var e=x(t),n="[object Object]"==e?t.constructor:void 0,r=n?tt(n):"";if(r)switch(r){case Be:return qe;case He:return Ue;case Qe:return We;case Ge:return Fe;case Ye:return Ve}return e});var Ze=Object.prototype.hasOwnProperty,Ke=D.Uint8Array;function Xe(t){var e=new t.constructor(t.byteLength);return new Ke(e).set(new Ke(t)),e}var tn=/\w*$/,en=A?A.prototype:void 0,nn=en?en.valueOf:void 0,rn="[object Boolean]",sn="[object Date]",on="[object Map]",an="[object Number]",cn="[object RegExp]",un="[object Set]",ln="[object String]",hn="[object Symbol]",dn="[object ArrayBuffer]",fn="[object DataView]",pn="[object Float32Array]",gn="[object Float64Array]",yn="[object Int8Array]",bn="[object Int16Array]",vn="[object Int32Array]",mn="[object Uint8Array]",wn="[object Uint8ClampedArray]",jn="[object Uint16Array]",_n="[object Uint32Array]";function On(t,e,n){var r,i=t.constructor;switch(e){case dn:return Xe(t);case rn:case sn:return new i(+t);case fn:return function(t,e){var n=e?Xe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case pn:case gn:case yn:case bn:case vn:case mn:case wn:case jn:case _n:return function(t,e){var n=e?Xe(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case on:return new i;case an:case ln:return new i(t);case cn:return function(t){var e=new t.constructor(t.source,tn.exec(t));return e.lastIndex=t.lastIndex,e}(t);case un:return new i;case hn:return r=t,nn?Object(nn.call(r)):{}}}var Sn=Ut&&Ut.isMap,Dn=Sn?Tt(Sn):function(t){return T(t)&&"[object Map]"==Je(t)},An=Ut&&Ut.isSet,Mn=An?Tt(An):function(t){return T(t)&&"[object Set]"==Je(t)},$n=1,En=2,Cn=4,In="[object Arguments]",Ln="[object Function]",Pn="[object GeneratorFunction]",kn="[object Object]",xn={};function Tn(t,e,n,r,i,s){var o,a=e&$n,c=e&En,u=e&Cn;if(void 0!==o)return o;if(!q(t))return t;var l=z(t);if(l){if(o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ze.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,o)}else{var h=Je(t),d=h==Ln||h==Pn;if(kt(t))return function(t,e){if(e)return t.slice();var n=t.length,r=$e?$e(n):new t.constructor(n);return t.copy(r),r}(t,a);if(h==kn||h==In||d&&!i){if(o=c||d?{}:function(t){return"function"!=typeof t.constructor||Dt(t)?{}:ht(Oe(t))}(t),!a)return c?function(t,e){return wt(t,Pe(t),e)}(t,function(t,e){return t&&wt(e,Kt(e),t)}(o,t)):function(t,e){return wt(t,Le(t),e)}(t,function(t,e){return t&&wt(e,Yt(e),t)}(o,t))}else{if(!xn[h])return i?t:{};o=On(t,h,a)}}s||(s=new Se);var f=s.get(t);if(f)return f;s.set(t,o),Mn(t)?t.forEach((function(r){o.add(Tn(r,e,n,0,t,s))})):Dn(t)&&t.forEach((function(r,i){o.set(i,Tn(r,e,n,0,t,s))}));var p=l?void 0:(u?c?Te:xe:c?Kt:Yt)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(p||t,(function(r,i){p&&(r=t[i=r]),mt(o,i,Tn(r,e,n,0,t,s))})),o}xn[In]=xn["[object Array]"]=xn["[object ArrayBuffer]"]=xn["[object DataView]"]=xn["[object Boolean]"]=xn["[object Date]"]=xn["[object Float32Array]"]=xn["[object Float64Array]"]=xn["[object Int8Array]"]=xn["[object Int16Array]"]=xn["[object Int32Array]"]=xn["[object Map]"]=xn["[object Number]"]=xn[kn]=xn["[object RegExp]"]=xn["[object Set]"]=xn["[object String]"]=xn["[object Symbol]"]=xn["[object Uint8Array]"]=xn["[object Uint8ClampedArray]"]=xn["[object Uint16Array]"]=xn["[object Uint32Array]"]=!0,xn["[object Error]"]=xn[Ln]=xn["[object WeakMap]"]=!1;var Rn=Object.prototype.hasOwnProperty;function Nn(t,e){return null!=t&&Rn.call(t,e)}function zn(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=me(e,t)).length,s=!1;++r<i;){var o=je(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&_t(i)&&gt(o,i)&&(z(t)||Ct(t))}(t,e,Nn)}var Un=Object.prototype.hasOwnProperty;function Wn(t,e,n){return null==t?t:function(t,e,n){if(!q(t))return t;for(var r=-1,i=(e=me(e,t)).length,s=i-1,o=t;null!=o&&++r<i;){var a=je(e[r]),c=n;if("__proto__"===a||"constructor"===a||"prototype"===a)return t;if(r!=s){var u=o[a];void 0===(c=void 0)&&(c=q(u)?u:gt(e[r+1])?[]:{})}mt(o,a,c),o=o[a]}return t}(t,e,n)}!function(t){t.exports=function(){var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",o="hour",a="day",c="week",u="month",l="quarter",h="year",d="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},b=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},v={s:b,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+b(r,2,"0")+":"+b(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,u),s=n-i<0,o=e.clone().add(r+(s?-1:1),u);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:h,w:c,d:a,D:d,h:o,m:s,s:i,ms:r,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",w={};w[m]=y;var j="$isDayjsObject",_=function(t){return t instanceof A||!(!t||!t[j])},O=function t(e,n,r){var i;if(!e)return m;if("string"==typeof e){var s=e.toLowerCase();w[s]&&(i=s),n&&(w[s]=n,i=s);var o=e.split("-");if(!i&&o.length>1)return t(o[0])}else{var a=e.name;w[a]=e,i=a}return!r&&i&&(m=i),i||!r&&m},S=function(t,e){if(_(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new A(n)},D=v;D.l=O,D.i=_,D.w=function(t,e){return S(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var A=function(){function y(t){this.$L=O(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[j]=!0}var b=y.prototype;return b.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(D.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(p);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.init()},b.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},b.$utils=function(){return D},b.isValid=function(){return!(this.$d.toString()===f)},b.isSame=function(t,e){var n=S(t);return this.startOf(e)<=n&&n<=this.endOf(e)},b.isAfter=function(t,e){return S(t)<this.startOf(e)},b.isBefore=function(t,e){return this.endOf(e)<S(t)},b.$g=function(t,e,n){return D.u(t)?this[e]:this.set(n,t)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(t,e){var n=this,r=!!D.u(e)||e,l=D.p(t),f=function(t,e){var i=D.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},p=function(t,e){return D.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},g=this.$W,y=this.$M,b=this.$D,v="set"+(this.$u?"UTC":"");switch(l){case h:return r?f(1,0):f(31,11);case u:return r?f(1,y):f(0,y+1);case c:var m=this.$locale().weekStart||0,w=(g<m?g+7:g)-m;return f(r?b-w:b+(6-w),y);case a:case d:return p(v+"Hours",0);case o:return p(v+"Minutes",1);case s:return p(v+"Seconds",2);case i:return p(v+"Milliseconds",3);default:return this.clone()}},b.endOf=function(t){return this.startOf(t,!1)},b.$set=function(t,e){var n,c=D.p(t),l="set"+(this.$u?"UTC":""),f=(n={},n[a]=l+"Date",n[d]=l+"Date",n[u]=l+"Month",n[h]=l+"FullYear",n[o]=l+"Hours",n[s]=l+"Minutes",n[i]=l+"Seconds",n[r]=l+"Milliseconds",n)[c],p=c===a?this.$D+(e-this.$W):e;if(c===u||c===h){var g=this.clone().set(d,1);g.$d[f](p),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},b.set=function(t,e){return this.clone().$set(t,e)},b.get=function(t){return this[D.p(t)]()},b.add=function(r,l){var d,f=this;r=Number(r);var p=D.p(l),g=function(t){var e=S(f);return D.w(e.date(e.date()+Math.round(t*r)),f)};if(p===u)return this.set(u,this.$M+r);if(p===h)return this.set(h,this.$y+r);if(p===a)return g(1);if(p===c)return g(7);var y=(d={},d[s]=e,d[o]=n,d[i]=t,d)[p]||1,b=this.$d.getTime()+r*y;return D.w(b,this)},b.subtract=function(t,e){return this.add(-1*t,e)},b.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=D.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,l=n.meridiem,h=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},d=function(t){return D.s(s%12||12,t,"0")},p=l||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(g,(function(t,r){return r||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return D.s(e.$y,4,"0");case"M":return a+1;case"MM":return D.s(a+1,2,"0");case"MMM":return h(n.monthsShort,a,u,3);case"MMMM":return h(u,a);case"D":return e.$D;case"DD":return D.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return h(n.weekdaysMin,e.$W,c,2);case"ddd":return h(n.weekdaysShort,e.$W,c,3);case"dddd":return c[e.$W];case"H":return String(s);case"HH":return D.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return p(s,o,!0);case"A":return p(s,o,!1);case"m":return String(o);case"mm":return D.s(o,2,"0");case"s":return String(e.$s);case"ss":return D.s(e.$s,2,"0");case"SSS":return D.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(r,d,f){var p,g=this,y=D.p(d),b=S(r),v=(b.utcOffset()-this.utcOffset())*e,m=this-b,w=function(){return D.m(g,b)};switch(y){case h:p=w()/12;break;case u:p=w();break;case l:p=w()/3;break;case c:p=(m-v)/6048e5;break;case a:p=(m-v)/864e5;break;case o:p=m/n;break;case s:p=m/e;break;case i:p=m/t;break;default:p=m}return f?p:D.a(p)},b.daysInMonth=function(){return this.endOf(u).$D},b.$locale=function(){return w[this.$L]},b.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=O(t,e,!0);return r&&(n.$L=r),n},b.clone=function(){return D.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},y}(),M=A.prototype;return S.prototype=M,[["$ms",r],["$s",i],["$m",s],["$H",o],["$W",a],["$M",u],["$y",h],["$D",d]].forEach((function(t){M[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),S.extend=function(t,e){return t.$i||(t(e,A,S),t.$i=!0),S},S.locale=O,S.isDayjs=_,S.unix=function(t){return S(1e3*t)},S.en=w[m],S.Ls=w,S.p={},S}()}({exports:{}}),function(t){t.exports=function(){var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,s){var o=i.prototype;s.utc=function(t){return new i({date:t,utc:!0,args:arguments})},o.utc=function(e){var n=s(this.toDate(),{locale:this.$L,utc:!0});return e?n.add(this.utcOffset(),t):n},o.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),a.call(this,t)};var c=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else c.call(this)};var u=o.utcOffset;o.utcOffset=function(r,i){var s=this.$utils().u;if(s(r))return this.$u?0:s(this.$offset)?u.call(this):this.$offset;if("string"==typeof r&&(r=function(t){void 0===t&&(t="");var r=t.match(e);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],s=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===s?o:-o}(r),null===r))return this;var o=Math.abs(r)<=16?60*r:r,a=this;if(i)return a.$offset=o,a.$u=0===r,a;if(0!==r){var c=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+c,t)).$offset=o,a.$x.$localOffset=c}else a=this.utc();return a};var l=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return l.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var h=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var d=o.diff;o.diff=function(t,e,n){if(t&&this.$u===t.$u)return d.call(this,t,e,n);var r=this.local(),i=s(t).local();return d.call(r,i,e,n)}}}()}({exports:{}});var Fn=(t=>(t.CONTAINER="container",t.PAGE="page",t.ROOT="app",t.PAGE_FRAGMENT="page-fragment",t))(Fn||{}),Vn=(t=>(t.COMP="comp",t.CODE="code",t.DATA_SOURCE="data-source",t))(Vn||{}),qn=(t=>(t.CODE="code",t))(qn||{}),Bn=(t=>(t.CODE="code",t.DATA_SOURCE_METHOD="data-source-method",t))(Bn||{});const Hn=(t,e=[])=>{const n=[],r=function(t,e){if(!Array.isArray(e))return null;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(n.push(s),`${s.id}`==`${t}`)return s;if(s.items){const e=r(t,s.items);if(e)return e}n.pop()}return null};return r(t,e),n},Qn=t=>"[object Object]"===Object.prototype.toString.call(t),Gn=t=>!!t&&Boolean(t.type?.toLowerCase()===Fn.PAGE),Yn=(t="",e={})=>(Array.isArray(t)?t:`${t}`.replaceAll(/\[(\d+)\]/g,".$1").split(".")).reduce(((t,e)=>{if(Qn(t)||Array.isArray(t))return t[e]}),e),Jn=(t,e,n={})=>Wn(n,t,e),Zn=(t,e=[])=>{const n=[],r=function(t,e){if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i],o=t.findIndex((t=>`${t}`==`${s.id}`));o>-1&&(t.slice(o,1),n.push(s)),s.items&&r(t,s.items)}};return r(t,e),n},Kn=(t={})=>Array.from(Object.values(t).reduce(((t,e)=>(Object.keys(e).forEach((e=>{t.add(e)})),t)),new Set)),Xn=(t,e,n)=>{const r=Hn(t.id,e),i=r.pop();let s=r.pop();if(n&&(s=Hn(n,e).pop()),!i)throw new Error("未找到目标节点");if(!s)throw new Error("未找到父节点");const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1,t)},tr="__tmagic__",er=(t,e,n={},r)=>{let i=[];if(r){const t=n[r];i=t?.[e.id].keys||[]}else i=((t={},e)=>Array.from(Object.values(t).reduce(((t,n)=>((n[e]?.keys||[]).forEach((e=>t.add(e))),t)),new Set)))(n,e.id);return i.forEach((n=>{const r=`${n}`.replaceAll(/\[(\d+)\]/g,".$1").split("."),i=r.map(((t,e)=>e<r.length-1?t:`${tr}${t}`)),s=Yn(n,e);let o,a=Yn(i,e);void 0===a&&(Jn(i.join("."),s,e),a=s);try{o=t(a)}catch(c){console.error(c),o=""}Jn(n,o,e)})),e},nr=(t,e,n,r=[])=>{switch("string"==typeof e&&void 0===n&&(n=""),t){case"is":case"=":return e===n;case"not":case"!=":return e!==n;case">":return e>n;case">=":return e>=n;case"<":return e<n;case"<=":return e<=n;case"between":return r.length>1&&e>=r[0]&&e<=r[1];case"not_between":return r.length<2||e<r[0]||e>r[1];case"include":return e?.includes?.(n);case"not_include":return void 0===e||!e.includes?.(n)}return!1},rr=t=>{const e={},n={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return t.forEach((t=>{if(void 0===t.defaultValue)"object"!==t.type?t.type?e[t.name]=n[t.type]:e[t.name]=void 0:e[t.name]=t.fields?rr(t.fields):n.object;else{if("array"===t.type&&!Array.isArray(t.defaultValue))return void(e[t.name]=n.array);if("object"===t.type&&!Qn(t.defaultValue)){if("string"==typeof t.defaultValue){try{e[t.name]=JSON.parse(t.defaultValue)}catch(r){e[t.name]=n.object}return}return void(e[t.name]=n.object)}e[t.name]=Tn(t.defaultValue,5)}})),e},ir="ds-field::",sr="ds-field-changed";var or=(t=>(t.DEFAULT="default",t.CODE_BLOCK="code-block",t.DATA_SOURCE="data-source",t.DATA_SOURCE_METHOD="data-source-method",t.DATA_SOURCE_COND="data-source-cond",t))(or||{});class ar{isTarget;id;name;type=(()=>or.DEFAULT)();deps={};isCollectByDefault;constructor(t){this.isTarget=t.isTarget,this.id=t.id,this.name=t.name,this.isCollectByDefault=t.isCollectByDefault??!0,t.type&&(this.type=t.type),t.initialDeps&&(this.deps=t.initialDeps)}updateDep({id:t,name:e,key:n,data:r}){const i=this.deps[t]||{name:e,keys:[]};i.name=e,i.data=r,this.deps[t]=i,-1===i.keys.indexOf(n)&&i.keys.push(n)}removeDep(t,e){if(void 0===t)return void Object.keys(this.deps).forEach((t=>{delete this.deps[t]}));const n=this.deps[t];if(n)if(e){const r=n.keys.indexOf(e);n.keys.splice(r,1),0===n.keys.length&&delete this.deps[t]}else delete this.deps[t]}hasDep(t,e){const n=this.deps[t];return Boolean(n?.keys.find((t=>t===e)))}destroy(){this.deps={}}}const cr=(t,e,n)=>{Object.values(t).forEach((t=>{Object.values(t).forEach((t=>{n&&t.type!==n||e(t)}))}))};class ur{targetsList={};childrenProp="items";idProp="id";nameProp="name";constructor(t){t?.initialTargets&&(this.targetsList=t.initialTargets),t?.childrenProp&&(this.childrenProp=t.childrenProp)}getTargetsList(){return this.targetsList}getTargets(t=or.DEFAULT){return this.targetsList[t]||{}}addTarget(t){const e=this.getTargets(t.type)||{};this.targetsList[t.type]=e,e[t.id]=t}getTarget(t,e=or.DEFAULT){return this.getTargets(e)[t]}hasTarget(t,e=or.DEFAULT){return Boolean(this.getTarget(t,e))}hasSpecifiedTypeTarget(t=or.DEFAULT){return Object.keys(this.getTargets(t)).length>0}removeTarget(t,e=or.DEFAULT){const n=this.getTargets(e);n[t]&&(n[t].destroy(),delete n[t])}removeTargets(t=or.DEFAULT){const e=this.targetsList[t];if(e){for(const t of Object.values(e))t.destroy();delete this.targetsList[t]}}clearTargets(){Object.keys(this.targetsList).forEach((t=>{delete this.targetsList[t]}))}collect(t,e={},n=!1,r){this.collectByCallback(t,r,(({node:t,target:r})=>{this.removeTargetDep(r,t),this.collectItem(t,r,e,n)}))}collectByCallback(t,e,n){cr(this.targetsList,(r=>{(e||r.isCollectByDefault)&&t.forEach((t=>{n({node:t,target:r})}))}),e)}clear(t,e){let{targetsList:n}=this;e&&(n={[e]:this.getTargets(e)});const r=[];cr(n,(e=>{t?t.forEach((t=>{e.removeDep(t[this.idProp]),Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&!r.includes(t[this.idProp])&&(r.push(t[this.idProp]),this.clear(t[this.childrenProp]))})):e.removeDep()}))}clearByType(t,e){this.clear(e,t)}collectItem(t,e,n={},r=!1){const i=(s,o="")=>{const a=(s,a)=>{const c=s===this.childrenProp,u=o?`${o}.${s}`:s;e.isTarget(u,a)?e.updateDep({id:t[this.idProp],name:`${t[this.nameProp]||t[this.idProp]}`,data:n,key:u}):!c&&Array.isArray(a)?a.forEach(((t,e)=>{Qn(t)&&i(t,`${u}[${e}]`)})):Qn(a)&&i(a,u),c&&r&&Array.isArray(a)&&a.forEach((t=>{this.collectItem(t,e,n,r)}))};Object.entries(s).forEach((([t,e])=>{void 0!==e&&""!==e&&a(t,e)}))};i(t)}removeTargetDep(t,e,n){t.removeDep(e[this.idProp],n),void 0===n&&Array.isArray(e[this.childrenProp])&&e[this.childrenProp].length&&e[this.childrenProp].forEach((e=>{this.removeTargetDep(t,e,n)}))}}
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function lr(t,e,n,r){return new(n||(n=Promise))((function(e,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function o(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(t){t(r)}))).then(s,o)}a((r=r.apply(t,[])).next())}))}const hr=[];class dr{constructor(t,e,n,r=void 0){this.obj=t,this.delimiter=e,this.wildcard=n,this.is_match=r}shortMatch(t,e){if(t===e)return!0;if(t===this.wildcard)return!0;if(this.is_match)return this.is_match(t,e);const n=t.indexOf(this.wildcard);if(n>-1){const r=t.substr(n+1);if(0===n||e.substring(0,n)===t.substring(0,n)){const t=r.length;return!(t>0)||e.substr(-t)===r}}return!1}match(t,e){return this.is_match?this.is_match(t,e):t===e||t===this.wildcard||e===this.wildcard||this.shortMatch(t,e)||function(t,e,n="*"){if(t===n)return!0;hr.length=0;let r=0,i=0,s=0,o=0;for(let h=0,d=t.length;h<d;h+=1){const e=t[h];e===n&&(r+=1,h>o&&hr.push(t.substring(o,h)),hr.push(e),o=h+1)}if(o<t.length&&hr.push(t.substring(o)),r?(i=t.length-r,s=1/0):s=i=t.length,0===hr.length)return t===e;const a=e.length;if(a<i||a>s)return!1;let c=hr.length-1,u=e.length-1,l=!1;for(;;){const t=hr[c];if(c-=1,t===n)l=!0;else{const n=u+1-t.length,r=e.lastIndexOf(t,n);if(-1===r||r>n)return!1;if(l)u=r-1,l=!1;else{if(r!==n)return!1;u-=t.length}}if(0>c)break}return!0}(t,e,this.wildcard)}handleArray(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);let c=0;for(const u of e){const e=c.toString(),n=""===r?e:r+this.delimiter+c;(a===this.wildcard||a===e||this.shortMatch(a,e))&&(o?i[n]=u:this.goFurther(t,u,s+1,n,i)),c++}return i}handleObject(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);for(let c in e){c=c.toString();const n=""===r?c:r+this.delimiter+c;(a===this.wildcard||a===c||this.shortMatch(a,c))&&(o?i[n]=e[c]:this.goFurther(t,e[c],s+1,n,i))}return i}goFurther(t,e,n,r,i={}){return Array.isArray(e)?this.handleArray(t,e,n,r,i):this.handleObject(t,e,n,r,i)}get(t){return this.goFurther(t,this.obj,0,"")}}class fr{static get(t,e,n=!1){if(!e)return;let r=e;for(const i of t)if(i in r)r=r[i];else{if(!n)return;r[i]=Object.create({}),r=r[i]}return r}static set(t,e,n){if(!n)return;if(0===t.length){for(const t in n)delete n[t];for(const t in e)n[t]=e[t];return}const r=t.slice(),i=r.pop(),s=fr.get(r,n,!0);return"object"==typeof s&&(s[i]=e),e}}let pr,gr=0,yr=null;function br(){return null!==yr&&yr.buffer===pr.memory.buffer||(yr=new Uint8Array(pr.memory.buffer)),yr}let vr=new TextEncoder("utf-8");const mr="function"==typeof vr.encodeInto?function(t,e){return vr.encodeInto(t,e)}:function(t,e){const n=vr.encode(t);return e.set(n),{read:t.length,written:n.length}};function wr(t,e,n){if(void 0===n){const n=vr.encode(t),r=e(n.length);return br().subarray(r,r+n.length).set(n),gr=n.length,r}let r=t.length,i=e(r);const s=br();let o=0;for(;o<r;o++){const e=t.charCodeAt(o);if(e>127)break;s[i+o]=e}if(o!==r){0!==o&&(t=t.slice(o)),i=n(i,r,r=o+3*t.length);const e=br().subarray(i+o,i+r);o+=mr(t,e).written}return gr=o,i}function jr(t,e){var n=wr(t,pr.__wbindgen_malloc,pr.__wbindgen_realloc),r=gr,i=wr(e,pr.__wbindgen_malloc,pr.__wbindgen_realloc),s=gr;return 0!==pr.is_match(n,r,i,s)}async function _r(t){("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:n}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if("application/wasm"==t.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,{});return pr=e.exports,_r.__wbindgen_wasm_module=n,pr}const Or={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function Sr(t,e){console.debug(t,e)}function Dr(t){return t&&t.constructor?"Object"===t.constructor.name:"object"==typeof t&&null!==t}class Ar{constructor(t={},e={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:Sr,Promise:Promise}),e),this.data=t,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=fr.get,this.pathSet=fr.set),e.Promise?this.resolved=e.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new dr(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(t,e=this.data,n=!1){const r=t.join(this.options.delimiter),i=this.cache.get(r);if(i){const t=i.deref();if(t)return t}const s=fr.get(t,e,n);return(Dr(s)||Array.isArray(s))&&this.cache.set(r,new WeakRef(s)),s}cacheSet(t,e,n=this.data){const r=t.join(this.options.delimiter);return Dr(e)||Array.isArray(e)?this.cache.set(r,new WeakRef(e)):this.cache.delete(r),fr.set(t,e,n)}silentSet(t,e){return this.pathSet(this.split(t),e,this.data)}loadWasmMatcher(t){return lr(this,0,void 0,(function*(){yield _r(t),this.is_match=jr,this.scan=new dr(this.data,this.options.delimiter,this.options.wildcard,this.is_match)}))}same(t,e){return(["number","string","undefined","boolean"].includes(typeof t)||null===t)&&e===t}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(t,e,n=!0){return this.is_match?this.is_match(t,e):t===e||t===this.options.wildcard||e===this.options.wildcard||!(!n&&this.getIndicesCount(this.options.delimiter,t)<this.getIndicesCount(this.options.delimiter,e))&&this.scan.match(t,e)}getIndicesOf(t,e){if(this.options.useIndicesCache&&this.indices.has(e))return this.indices.get(e);const n=t.length;if(0==n)return[];let r,i=0,s=[];for(;(r=e.indexOf(t,i))>-1;)s.push(r),i=r+n;return this.options.useIndicesCache&&this.indices.set(e,s),s}getIndicesCount(t,e){if(this.options.useIndicesCache&&this.indicesCount.has(e))return this.indicesCount.get(e);const n=t.length;if(0==n)return 0;let r,i=0,s=0;for(;(r=e.indexOf(t,i))>-1;)s++,i=r+n;return this.options.useIndicesCache&&this.indicesCount.set(e,s),s}cutPath(t,e){if(""===e)return"";if((t=this.cleanNotRecursivePath(t))===(e=this.cleanNotRecursivePath(e)))return t;const n=this.getIndicesCount(this.options.delimiter,e),r=this.getIndicesOf(this.options.delimiter,t);return t.substring(0,r[n])}trimPath(t){return(t=this.cleanNotRecursivePath(t)).charAt(0)===this.options.delimiter?t.substr(1):t}split(t){if(""===t)return[];if(!this.options.useSplitCache)return t.split(this.options.delimiter);const e=this.splitCache.get(t);if(e)return e.slice();const n=t.split(this.options.delimiter);return this.splitCache.set(t,n.slice()),n}isWildcard(t){return t.includes(this.options.wildcard)||this.hasParams(t)}isNotRecursive(t){return t.endsWith(this.options.notRecursive)}cleanNotRecursivePath(t){return this.isNotRecursive(t)?t.substring(0,t.length-1):t}hasParams(t){return t.includes(this.options.param)}getParamsInfo(t){let e={replaced:"",original:t,params:{}},n=0,r=[];for(const i of this.split(t)){e.params[n]={original:i,replaced:"",name:""};const t=new RegExp(`\\${this.options.param}([^\\${this.options.delimiter}\\${this.options.param}]+)`,"g");let s=t.exec(i);s?(e.params[n].name=s[1],t.lastIndex=0,e.params[n].replaced=i.replace(t,this.options.wildcard),r.push(e.params[n].replaced),n++):(delete e.params[n],r.push(i),n++)}return e.replaced=r.join(this.options.delimiter),e}getParams(t,e){if(!t)return;const n=this.split(e),r={};for(const i in t.params)r[t.params[i].name]=n[i];return r}waitForAll(t,e){const n={};for(let r of t)n[r]={dirty:!1},this.hasParams(r)&&(n[r].paramsInfo=this.getParamsInfo(r)),n[r].isWildcard=this.isWildcard(r),n[r].isRecursive=!this.isNotRecursive(r);return this.waitingListeners.set(t,{fn:e,paths:n}),e(n),function(){this.waitingListeners.delete(t)}}executeWaitingListeners(t){if(!this.destroyed)for(const e of this.waitingListeners.values()){const{fn:n,paths:r}=e;let i=0,s=0;for(let e in r){const n=r[e];let o=!1;n.isRecursive&&(t=this.cutPath(t,e)),n.isWildcard&&this.match(e,t)&&(o=!0),t===e&&(o=!0),o&&(n.dirty=!0),n.dirty&&i++,s++}i===s&&n(r)}}subscribeAll(t,e,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let r=[],i=0,s=null;"boolean"==typeof n.group&&n.group?(this.groupId++,s=this.groupId,n.bulk=!0):"string"==typeof n.group&&(n.bulk=!0,s=n.group);for(const o of t)r.push(this.subscribe(o,e,n,{all:t,index:i,groupId:s})),i++;return function(){for(const t of r)t()}}getCleanListenersCollection(t={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},t)}getCleanListener(t,e=this.getDefaultListenerOptions()){return{fn:t,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),e),groupId:null}}getListenerCollectionMatch(t,e,n){t=this.cleanNotRecursivePath(t);const r=this;return function(i,s=!1){let o=t;return e?i=r.cutPath(i,t):o=r.cutPath(r.cleanNotRecursivePath(t),i),s&&console.log("[getListenerCollectionMatch]",{listenerPath:t,scopedListenerPath:o,path:i,isRecursive:e,isWildcard:n}),!(!n||!r.match(o,i,e))||o===i}}getListenersCollection(t,e){if(this.listeners.has(t)){let n=this.listeners.get(t);return n.listeners.set(++this.id,e),e.id=this.id,n}const n=this.hasParams(t);let r;n&&(r=this.getParamsInfo(t));let i={isRecursive:!this.isNotRecursive(t),isWildcard:this.isWildcard(t),hasParams:n,paramsInfo:r,originalPath:t,path:n?r.replaced:t};i.isRecursive||(i.path=this.cleanNotRecursivePath(i.path));let s=this.getCleanListenersCollection(Object.assign(Object.assign({},i),{match:this.getListenerCollectionMatch(i.path,i.isRecursive,i.isWildcard)}));return this.id++,s.listeners.set(this.id,e),e.id=this.id,this.listeners.set(i.originalPath,s),s}subscribe(t,e,n=this.getDefaultListenerOptions(),r={all:[t],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const i="subscribe";let s=this.getCleanListener(e,n);n.group&&(n.bulk=!0,"string"==typeof n.group?s.groupId=n.group:r.groupId&&(s.groupId=r.groupId)),this.listenersIgnoreCache.set(s,{truthy:[],falsy:[]});const o=this.getListenersCollection(t,s);n.debug&&console.log("[subscribe]",{listenerPath:t,options:n}),o.count++;let a=!0;if(s.groupId&&("string"==typeof s.groupId?this.namedGroups.includes(s.groupId)?a=!1:this.namedGroups.push(s.groupId):"number"==typeof s.groupId&&(this.numberGroups.includes(s.groupId)?a=!1:this.numberGroups.push(s.groupId))),a){const r=this.cleanNotRecursivePath(o.path),a=this.split(r);if(o.isWildcard){const a=this.scan.get(r);if(n.bulk){const r=[];for(const t in a)this.isMuted(t)||r.push({path:t,params:this.getParams(o.paramsInfo,t),value:a[t]});this.isMuted(e)||e(r,{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const r in a)this.isMuted(r)||this.isMuted(e)||e(a[r],{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(o.paramsInfo,r),options:n})}else this.isMuted(r)||this.isMuted(e)||e(this.pathGet(a,this.data),{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(t)},params:this.getParams(o.paramsInfo,r),options:n})}return this.debugSubscribe(s,o,t),this.jobsRunning--,this.unsubscribe(t,this.id)}unsubscribe(t,e){const n=this.listeners,r=n.get(t);return function(){r.listeners.delete(e),r.count--,0===r.count&&n.delete(t)}}runQueuedListeners(){if(!this.destroyed&&0!==this.subscribeQueue.length)if(0===this.jobsRunning){this.queueRuns=0;const t=[...this.subscribeQueue];for(let e=0,n=t.length;e<n;e++)t[e]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then((()=>this.runQueuedListeners())).catch((t=>{throw t}))}}getQueueNotifyListeners(t,e=[]){for(const n in t){if(this.isMuted(n))continue;let{single:r,bulk:i}=t[n];for(const t of r){let n=!1,r=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(r=t.listener.id+":"+t.eventInfo.path.listener);for(const t of e)if(r===t.resolvedIdPath){n=!0;break}if(n)continue;const i=this.debugTime(t);if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)}));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(i,t)}for(const t of i){let n=!1;for(const s of e)if(s.id===t.listener.id){n=!0;break}if(n)continue;const r=this.debugTime(t),i=[];for(const e of t.value)i.push(Object.assign(Object.assign({},e),{value:e.value?e.value():void 0}));if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>!this.jobsRunning&&(t.listener.fn(i,t.eventInfo),!0)));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(i,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(r,t)}}return Promise.resolve().then((()=>this.runQueuedListeners())),e}shouldIgnore(t,e){if(!t.options.ignore)return!1;for(const n of t.options.ignore){if(e.startsWith(n))return!0;if(this.is_match&&this.is_match(n,e))return!0;{const t=this.cutPath(e,n);if(this.match(n,t))return!0}}return!1}getSubscribedListeners(t,e,n,r="update",i=null){n=Object.assign(Object.assign({},Or),n);const s={};for(let[o,a]of this.listeners)if(a.match(t)){s[o]={single:[],bulk:[],bulkData:[]};const c=a.paramsInfo?this.getParams(a.paramsInfo,t):void 0,u=this.cutPath(t,o),l=a.isRecursive||a.isWildcard?()=>this.get(u):()=>e,h=[{value:l,path:t,params:c}];for(const e of a.listeners.values())this.shouldIgnore(e,t)?e.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:e,listenersCollection:a}):e.options.bulk?s[o].bulk.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:void 0},params:c,options:n},value:h}):s[o].single.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:this.cleanNotRecursivePath(t)},params:c,options:n},value:l})}else if(this.options.extraDebug){let e=!1;for(const n of a.listeners.values())n.options.debug&&(e=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:n,listenersCollection:a,updatePath:t}));e&&a.match(t,!0)}return s}notifySubscribedListeners(t,e,n,r="update",i=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(t,e,n,r,i))}useBulkValue(t){for(const[e,n]of t.listeners){if(n.options.bulk&&n.options.bulkValue)return!0;if(!n.options.bulk)return!0}return!1}getNestedListeners(t,e,n,r="update",i=null){const s={},o={};for(let[a,c]of this.listeners){if(!c.isRecursive)continue;const u=this.cutPath(a,t);if(this.match(u,t)){s[a]={single:[],bulk:[]};const l=this.trimPath(a.substr(u.length)),h=this.useBulkValue(c);let d;h&&(d=o[l]?o[l]:new dr(e,this.options.delimiter,this.options.wildcard).get(l),o[l]=d);const f=c.paramsInfo?this.getParams(c.paramsInfo,t):void 0,p=[],g={};for(const[e,o]of c.listeners)if(h)for(const u in d){const l=()=>d[u],h=[t,u].join(this.options.delimiter),y={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:this.cleanNotRecursivePath(h)},params:f,options:n};this.shouldIgnore(o,t)||(o.options.bulk?(p.push({value:l,path:h,params:f}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:y,value:l}))}else{const u={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:void 0},params:f,options:n};if(this.shouldIgnore(o,t))continue;o.options.bulk?(p.push({value:void 0,path:void 0,params:f}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:u,value:void 0})}for(const e in g){const i=g[e],o={type:r,listener:i,listenersCollection:c,path:{listener:a,update:t,resolved:void 0},options:n,params:f};s[a].bulk.push({listener:i,listenersCollection:c,eventInfo:o,value:p})}}else if(this.options.extraDebug)for(const e of c.listeners.values())e.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:e,listenersCollection:c,currentCutPath:u,updatePath:t})}return s}notifyNestedListeners(t,e,n,r="update",i,s=null){return this.getQueueNotifyListeners(this.getNestedListeners(t,e,n,r,s),i)}getNotifyOnlyListeners(t,e,n,r="update",i=null){const s={};if("object"!=typeof n.only||!Array.isArray(n.only)||void 0===n.only[0]||!this.canBeNested(e))return s;for(const o of n.only){const a=new dr(e,this.options.delimiter,this.options.wildcard).get(o);s[o]={bulk:[],single:[]};for(const e in a){const c=t+this.options.delimiter+e;for(const[u,l]of this.listeners){const h=l.paramsInfo?this.getParams(l.paramsInfo,c):void 0;if(this.match(u,c)){const d=()=>a[e],f=[{value:d,path:c,params:h}];for(const e of l.listeners.values()){const a={type:r,listener:e,listenersCollection:l,path:{listener:u,update:i||t,resolved:this.cleanNotRecursivePath(c)},params:h,options:n};this.shouldIgnore(e,t)||(e.options.bulk?s[o].bulk.some((t=>t.listener===e))||s[o].bulk.push({listener:e,listenersCollection:l,eventInfo:a,value:f}):s[o].single.push({listener:e,listenersCollection:l,eventInfo:a,value:d}))}}}}}return s}runQueue(t){const e=[];for(const n of t)n.options.group?e.includes(n.groupId)||(n.fn(),e.push(n.groupId)):n.fn()}sortAndRunQueue(t,e){t.sort((function(t,e){return t.id-e.id})),this.options.debug&&console.log(`[deep-state-observer] queue for ${e}`,t),this.runQueue(t)}notifyOnly(t,e,n,r="update",i=""){const s=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(t,e,n,r,i));this.sortAndRunQueue(s,t)}canBeNested(t){return"object"==typeof t&&null!==t}getUpdateValues(t,e){let n=e;return"function"==typeof e&&(n=e(t)),{newValue:n,oldValue:t}}wildcardNotify(t,e){let n=[];for(const r of t)this.getQueueNotifyListeners(r,n);for(const r of e)this.executeWaitingListeners(r);return this.jobsRunning--,n}wildcardUpdate(t,e,n=Or,r=!1){++this.jobsRunning,n=Object.assign(Object.assign({},Or),n);const i=this.scan.get(t),s={};for(const u in i){const t=this.split(u),{oldValue:r,newValue:o}=this.getUpdateValues(i[u],e);this.same(o,r)&&!n.force||(this.pathSet(t,o,this.data),s[u]=o)}const o=[],a=[];for(const u in s){const e=s[u];n.only.length?o.push(this.getNotifyOnlyListeners(u,e,n,"update",t)):(o.push(this.getSubscribedListeners(u,e,n,"update",t)),this.canBeNested(e)&&o.push(this.getNestedListeners(u,e,n,"update",t))),n.debug&&this.options.log("Wildcard update",{path:u,newValue:e}),a.push(u)}if(r){const e=this;return function(){const n=e.wildcardNotify(o,a);e.sortAndRunQueue(n,t)}}const c=this.wildcardNotify(o,a);this.sortAndRunQueue(c,t)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const t=this.updateQueue.shift();t.options.queue=!1,this.update(t.updatePath,t.fnOrValue,t.options,t.multi)}}updateNotify(t,e,n){const r=this.notifySubscribedListeners(t,e,n);this.canBeNested(e)&&this.notifyNestedListeners(t,e,n,"update",r),this.sortAndRunQueue(r,t),this.executeWaitingListeners(t)}updateNotifyAll(t){let e=[];for(const n of t){const t=n.newValue;if(this.tracing.length){const e=this.tracing[this.tracing.length-1],r=this.traceMap.get(e);r.changed.push({traceId:e,updatePath:n.updatePath,fnOrValue:t,options:n.options}),this.traceMap.set(e,r)}e=e.concat(this.notifySubscribedListeners(n.updatePath,t,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,t,n.options,"update",e)}this.runQueue(e)}updateNotifyOnly(t,e,n){this.notifyOnly(t,e,n),this.executeWaitingListeners(t)}update(t,e,n=Object.assign({},Or),r=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(t,e,n);if(this.tracing.length){const r=this.tracing[this.tracing.length-1],i=this.traceMap.get(r);i.changed.push({traceId:r,updatePath:t,fnOrValue:e,options:n}),this.traceMap.set(r,i)}const i=this.jobsRunning;if((this.options.queue||n.queue)&&i){if(i>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:t,fnOrValue:e,options:n,multi:r});const s=Promise.resolve().then((()=>{this.runUpdateQueue()}));return r?function(){return s}:s}if(this.isWildcard(t))return this.wildcardUpdate(t,e,n,r);++this.jobsRunning;const s=this.split(t),o=this.pathGet(s,this.data);let{oldValue:a,newValue:c}=this.getUpdateValues(o,e);if(n.debug&&this.options.log(`Updating ${t} ${n.source?`from ${n.source}`:""}`,{oldValue:a,newValue:c}),this.same(c,a)&&!n.force)return--this.jobsRunning,r?function(){return c}:c;if(this.pathSet(s,c,this.data),null===(n=Object.assign(Object.assign({},Or),n)).only)return--this.jobsRunning,r?function(){}:c;if(n.only.length){if(--this.jobsRunning,r){const e=this;return function(){return e.updateNotifyOnly(t,c,n)}}return this.updateNotifyOnly(t,c,n),c}if(r){--this.jobsRunning;const e=this;return function(){return e.updateNotify(t,c,n)}}return this.updateNotify(t,c,n),--this.jobsRunning,c}multi(t=!1){if(this.destroyed)return{update(){return this},done(){},getStack:()=>[]};if(this.collection)return this.collection;const e=this,n=[],r=[];return{update(i,s,o=Or){if(t){const t=e.split(i);let r=s;const a=e.pathGet(t,e.data);"function"==typeof r&&(r=r(a)),e.pathSet(t,r,e.data),n.push({updatePath:i,newValue:r,options:o})}else r.push(e.update(i,s,o,!0));return this},done(){if(0===e.collections){if(t)e.updateNotifyAll(n);else for(const t of r)t();n.length=0}},getStack:()=>n}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,0===this.collections&&this.collection){const t=this.collection;this.collection=null,t.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(t=void 0){if(!this.destroyed)return void 0===t||""===t?this.data:this.isWildcard(t)?this.scan.get(t):this.pathGet(this.split(t),this.data)}last(t){let e=this.lastExecs.get(t);e||(e={calls:0},this.lastExecs.set(t,e));const n=++e.calls;this.resolved.then((()=>{n===e.calls&&(this.lastExecs.set(t,{calls:0}),t())}))}isMuted(t){if(!this.options.useMute)return!1;if("function"==typeof t)return this.isMutedListener(t);for(const e of this.muted){const n=!this.isNotRecursive(e),r=this.trimPath(e);if(this.match(t,r))return!0;if(this.match(r,t))return!0;if(n){const n=this.cutPath(r,t);if(this.match(n,e))return!0;if(this.match(e,n))return!0}}return!1}isMutedListener(t){return this.mutedListeners.has(t)}mute(t){if("function"==typeof t)return this.mutedListeners.add(t);this.muted.add(t)}unmute(t){if("function"==typeof t)return this.mutedListeners.delete(t);this.muted.delete(t)}debugSubscribe(t,e,n){t.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:t,listenersCollection:e})}debugListener(t,e){(e.eventInfo.options.debug||e.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-t,info:e})}debugTime(t){return t.listener.options.debug||t.eventInfo.options.debug?Date.now():0}startTrace(t,e=null){this.traceId++;const n=this.traceId+":"+t;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map((t=>t)),additionalData:e,changed:[]}),this.tracing.push(n),n}stopTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),e}saveTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),this.savedTrace.push(e),e}getSavedTraces(){const t=this.savedTrace.map((t=>t));return t.sort(((t,e)=>t.sort-e.sort)),this.savedTrace=[],t}}var Mr="object"==typeof global&&global&&global.Object===Object&&global,$r="object"==typeof self&&self&&self.Object===Object&&self,Er=Mr||$r||Function("return this")(),Cr=Er.Symbol,Ir=Object.prototype,Lr=Ir.hasOwnProperty,Pr=Ir.toString,kr=Cr?Cr.toStringTag:void 0,xr=Object.prototype.toString,Tr="[object Null]",Rr="[object Undefined]",Nr=Cr?Cr.toStringTag:void 0;function zr(t){return null==t?void 0===t?Rr:Tr:Nr&&Nr in Object(t)?function(t){var e=Lr.call(t,kr),n=t[kr];try{t[kr]=void 0;var r=!0}catch(s){}var i=Pr.call(t);return r&&(e?t[kr]=n:delete t[kr]),i}(t):function(t){return xr.call(t)}(t)}function Ur(t){return null!=t&&"object"==typeof t}var Wr="[object Symbol]";function Fr(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Vr=Array.isArray,qr=1/0,Br=Cr?Cr.prototype:void 0,Hr=Br?Br.toString:void 0;function Qr(t){if("string"==typeof t)return t;if(Vr(t))return Fr(t,Qr)+"";if(function(t){return"symbol"==typeof t||Ur(t)&&zr(t)==Wr}(t))return Hr?Hr.call(t):"";var e=t+"";return"0"==e&&1/t==-qr?"-0":e}function Gr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Yr(t){return t}var Jr="[object AsyncFunction]",Zr="[object Function]",Kr="[object GeneratorFunction]",Xr="[object Proxy]";function ti(t){if(!Gr(t))return!1;var e=zr(t);return e==Zr||e==Kr||e==Jr||e==Xr}var ei=Er["__core-js_shared__"],ni=function(){var t=/[^.]+$/.exec(ei&&ei.keys&&ei.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ri=Function.prototype.toString;function ii(t){if(null!=t){try{return ri.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var si=/^\[object .+?Constructor\]$/,oi=Function.prototype,ai=Object.prototype,ci=oi.toString,ui=ai.hasOwnProperty,li=RegExp("^"+ci.call(ui).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hi(t){return!(!Gr(t)||function(t){return!!ni&&ni in t}(t))&&(ti(t)?li:si).test(ii(t))}function di(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return hi(n)?n:void 0}var fi=di(Er,"WeakMap"),pi=Object.create,gi=function(){function t(){}return function(e){if(!Gr(e))return{};if(pi)return pi(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function yi(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var bi=Date.now,vi=function(){try{var t=di(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),mi=vi?function(t,e){return vi(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Yr,wi=function(t){var e=0,n=0;return function(){var r=bi(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(mi);function ji(t){return t!=t}function _i(t,e){return!(null==t||!t.length)&&function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n){for(var r=t.length,i=n+-1;++i<r;)if(e(t[i],i,t))return i;return-1}(t,ji,n)}(t,e,0)>-1}var Oi=9007199254740991,Si=/^(?:0|[1-9]\d*)$/;function Di(t,e){var n=typeof t;return!!(e=null==e?Oi:e)&&("number"==n||"symbol"!=n&&Si.test(t))&&t>-1&&t%1==0&&t<e}function Ai(t,e,n){"__proto__"==e&&vi?vi(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Mi(t,e){return t===e||t!=t&&e!=e}var $i=Object.prototype.hasOwnProperty;function Ei(t,e,n){var r=t[e];$i.call(t,e)&&Mi(r,n)&&(void 0!==n||e in t)||Ai(t,e,n)}var Ci=Math.max;function Ii(t,e){return wi(function(t,e,n){return e=Ci(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=Ci(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),yi(t,this,a)}}(t,e,Yr),t+"")}var Li=9007199254740991;function Pi(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Li}function ki(t){return null!=t&&Pi(t.length)&&!ti(t)}var xi=Object.prototype;function Ti(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||xi)}function Ri(t){return Ur(t)&&"[object Arguments]"==zr(t)}var Ni=Object.prototype,zi=Ni.hasOwnProperty,Ui=Ni.propertyIsEnumerable,Wi=Ri(function(){return arguments}())?Ri:function(t){return Ur(t)&&zi.call(t,"callee")&&!Ui.call(t,"callee")},Fi="object"==typeof t&&t&&!t.nodeType&&t,Vi=Fi&&"object"==typeof e&&e&&!e.nodeType&&e,qi=Vi&&Vi.exports===Fi?Er.Buffer:void 0,Bi=(qi?qi.isBuffer:void 0)||function(){return!1},Hi={};function Qi(t){return function(e){return t(e)}}Hi["[object Float32Array]"]=Hi["[object Float64Array]"]=Hi["[object Int8Array]"]=Hi["[object Int16Array]"]=Hi["[object Int32Array]"]=Hi["[object Uint8Array]"]=Hi["[object Uint8ClampedArray]"]=Hi["[object Uint16Array]"]=Hi["[object Uint32Array]"]=!0,Hi["[object Arguments]"]=Hi["[object Array]"]=Hi["[object ArrayBuffer]"]=Hi["[object Boolean]"]=Hi["[object DataView]"]=Hi["[object Date]"]=Hi["[object Error]"]=Hi["[object Function]"]=Hi["[object Map]"]=Hi["[object Number]"]=Hi["[object Object]"]=Hi["[object RegExp]"]=Hi["[object Set]"]=Hi["[object String]"]=Hi["[object WeakMap]"]=!1;var Gi="object"==typeof t&&t&&!t.nodeType&&t,Yi=Gi&&"object"==typeof e&&e&&!e.nodeType&&e,Ji=Yi&&Yi.exports===Gi&&Mr.process,Zi=function(){try{var t=Yi&&Yi.require&&Yi.require("util").types;return t||Ji&&Ji.binding&&Ji.binding("util")}catch(e){}}(),Ki=Zi&&Zi.isTypedArray,Xi=Ki?Qi(Ki):function(t){return Ur(t)&&Pi(t.length)&&!!Hi[zr(t)]},ts=Object.prototype.hasOwnProperty;function es(t,e){var n=Vr(t),r=!n&&Wi(t),i=!n&&!r&&Bi(t),s=!n&&!r&&!i&&Xi(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!ts.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Di(u,c))||a.push(u);return a}function ns(t,e){return function(n){return t(e(n))}}var rs=ns(Object.keys,Object),is=Object.prototype.hasOwnProperty;function ss(t){return ki(t)?es(t):function(t){if(!Ti(t))return rs(t);var e=[];for(var n in Object(t))is.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var os=Object.prototype.hasOwnProperty;function as(t){if(!Gr(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Ti(t),n=[];for(var r in t)("constructor"!=r||!e&&os.call(t,r))&&n.push(r);return n}var cs,us=(cs=function(t,e,n,r){!function(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),i?Ai(n,a,c):Ei(n,a,c)}}(e,function(t){return ki(t)?es(t,!0):as(t)}(e),t,r)},Ii((function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,s=r>2?e[2]:void 0;for(i=cs.length>3&&"function"==typeof i?(r--,i):void 0,s&&function(t,e,n){if(!Gr(n))return!1;var r=typeof e;return!!("number"==r?ki(n)&&Di(e,n.length):"string"==r&&e in n)&&Mi(n[e],t)}(e[0],e[1],s)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var o=e[n];o&&cs(t,o,n,i)}return t}))),ls=di(Object,"create"),hs=Object.prototype.hasOwnProperty,ds=Object.prototype.hasOwnProperty;function fs(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ps(t,e){for(var n=t.length;n--;)if(Mi(t[n][0],e))return n;return-1}fs.prototype.clear=function(){this.__data__=ls?ls(null):{},this.size=0},fs.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},fs.prototype.get=function(t){var e=this.__data__;if(ls){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return hs.call(e,t)?e[t]:void 0},fs.prototype.has=function(t){var e=this.__data__;return ls?void 0!==e[t]:ds.call(e,t)},fs.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ls&&void 0===e?"__lodash_hash_undefined__":e,this};var gs=Array.prototype.splice;function ys(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ys.prototype.clear=function(){this.__data__=[],this.size=0},ys.prototype.delete=function(t){var e=this.__data__,n=ps(e,t);return!(n<0||(n==e.length-1?e.pop():gs.call(e,n,1),--this.size,0))},ys.prototype.get=function(t){var e=this.__data__,n=ps(e,t);return n<0?void 0:e[n][1]},ys.prototype.has=function(t){return ps(this.__data__,t)>-1},ys.prototype.set=function(t,e){var n=this.__data__,r=ps(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var bs=di(Er,"Map");function vs(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function ms(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ws(t){return null==t?"":Qr(t)}function js(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}ms.prototype.clear=function(){this.size=0,this.__data__={hash:new fs,map:new(bs||ys),string:new fs}},ms.prototype.delete=function(t){var e=vs(this,t).delete(t);return this.size-=e?1:0,e},ms.prototype.get=function(t){return vs(this,t).get(t)},ms.prototype.has=function(t){return vs(this,t).has(t)},ms.prototype.set=function(t,e){var n=vs(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var _s=Cr?Cr.isConcatSpreadable:void 0;function Os(t){return Vr(t)||Wi(t)||!!(_s&&t&&t[_s])}var Ss=ns(Object.getPrototypeOf,Object),Ds="[object Object]",As=Function.prototype,Ms=Object.prototype,$s=As.toString,Es=Ms.hasOwnProperty,Cs=$s.call(Object),Is="[object DOMException]",Ls="[object Error]";function Ps(t){if(!Ur(t))return!1;var e=zr(t);return e==Ls||e==Is||"string"==typeof t.message&&"string"==typeof t.name&&!function(t){if(!Ur(t)||zr(t)!=Ds)return!1;var e=Ss(t);if(null===e)return!0;var n=Es.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&$s.call(n)==Cs}(t)}var ks=Ii((function(t,e){try{return yi(t,void 0,e)}catch(n){return Ps(n)?n:new Error(n)}}));function xs(t){var e=this.__data__=new ys(t);this.size=e.size}xs.prototype.clear=function(){this.__data__=new ys,this.size=0},xs.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},xs.prototype.get=function(t){return this.__data__.get(t)},xs.prototype.has=function(t){return this.__data__.has(t)},xs.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ys){var r=n.__data__;if(!bs||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new ms(r)}return n.set(t,e),this.size=n.size,this};var Ts="object"==typeof t&&t&&!t.nodeType&&t,Rs=Ts&&"object"==typeof e&&e&&!e.nodeType&&e,Ns=Rs&&Rs.exports===Ts?Er.Buffer:void 0;Ns&&Ns.allocUnsafe;var zs=Object.prototype.propertyIsEnumerable,Us=Object.getOwnPropertySymbols,Ws=Us?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}(Us(t),(function(e){return zs.call(t,e)})))}:function(){return[]};function Fs(t){return function(t,e,n){var r=e(t);return Vr(t)?r:js(r,n(t))}(t,ss,Ws)}var Vs=di(Er,"DataView"),qs=di(Er,"Promise"),Bs=di(Er,"Set"),Hs="[object Map]",Qs="[object Promise]",Gs="[object Set]",Ys="[object WeakMap]",Js="[object DataView]",Zs=ii(Vs),Ks=ii(bs),Xs=ii(qs),to=ii(Bs),eo=ii(fi),no=zr;(Vs&&no(new Vs(new ArrayBuffer(1)))!=Js||bs&&no(new bs)!=Hs||qs&&no(qs.resolve())!=Qs||Bs&&no(new Bs)!=Gs||fi&&no(new fi)!=Ys)&&(no=function(t){var e=zr(t),n="[object Object]"==e?t.constructor:void 0,r=n?ii(n):"";if(r)switch(r){case Zs:return Js;case Ks:return Hs;case Xs:return Qs;case to:return Gs;case eo:return Ys}return e});var ro=Object.prototype.hasOwnProperty,io=Er.Uint8Array;function so(t){var e=new t.constructor(t.byteLength);return new io(e).set(new io(t)),e}var oo=/\w*$/,ao=Cr?Cr.prototype:void 0,co=ao?ao.valueOf:void 0,uo="[object Boolean]",lo="[object Date]",ho="[object Map]",fo="[object Number]",po="[object RegExp]",go="[object Set]",yo="[object String]",bo="[object Symbol]",vo="[object ArrayBuffer]",mo="[object DataView]",wo="[object Float32Array]",jo="[object Float64Array]",_o="[object Int8Array]",Oo="[object Int16Array]",So="[object Int32Array]",Do="[object Uint8Array]",Ao="[object Uint8ClampedArray]",Mo="[object Uint16Array]",$o="[object Uint32Array]";function Eo(t,e,n){var r,i,s,o=t.constructor;switch(e){case vo:return so(t);case uo:case lo:return new o(+t);case mo:return s=so((i=t).buffer),new i.constructor(s,i.byteOffset,i.byteLength);case wo:case jo:case _o:case Oo:case So:case Do:case Ao:case Mo:case $o:return function(t){var e=so(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case ho:return new o;case fo:case yo:return new o(t);case po:return function(t){var e=new t.constructor(t.source,oo.exec(t));return e.lastIndex=t.lastIndex,e}(t);case go:return new o;case bo:return r=t,co?Object(co.call(r)):{}}}var Co=Zi&&Zi.isMap,Io=Co?Qi(Co):function(t){return Ur(t)&&"[object Map]"==no(t)},Lo=Zi&&Zi.isSet,Po=Lo?Qi(Lo):function(t){return Ur(t)&&"[object Set]"==no(t)},ko="[object Arguments]",xo="[object Function]",To="[object GeneratorFunction]",Ro="[object Object]",No={};function zo(t,e,n,r,i,s){var o;if(void 0!==o)return o;if(!Gr(t))return t;var a=Vr(t);if(a)o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ro.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t);else{var c=no(t),u=c==xo||c==To;if(Bi(t))return t.slice();if(c==Ro||c==ko||u&&!i)o=u?{}:function(t){return"function"!=typeof t.constructor||Ti(t)?{}:gi(Ss(t))}(t);else{if(!No[c])return i?t:{};o=Eo(t,c)}}s||(s=new xs);var l=s.get(t);if(l)return l;s.set(t,o),Po(t)?t.forEach((function(r){o.add(zo(r,e,n,0,t,s))})):Io(t)&&t.forEach((function(r,i){o.set(i,zo(r,e,n,0,t,s))}));var h=a?void 0:Fs(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(h||t,(function(r,i){h&&(r=t[i=r]),Ei(o,i,zo(r,e,n,0,t,s))})),o}function Uo(t){return zo(t,5)}function Wo(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new ms;++e<n;)this.add(t[e])}function Fo(t,e){return t.has(e)}function Vo(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function qo(t){return Ur(t)&&ki(t)}No[ko]=No["[object Array]"]=No["[object ArrayBuffer]"]=No["[object DataView]"]=No["[object Boolean]"]=No["[object Date]"]=No["[object Float32Array]"]=No["[object Float64Array]"]=No["[object Int8Array]"]=No["[object Int16Array]"]=No["[object Int32Array]"]=No["[object Map]"]=No["[object Number]"]=No[Ro]=No["[object RegExp]"]=No["[object Set]"]=No["[object String]"]=No["[object Symbol]"]=No["[object Uint8Array]"]=No["[object Uint8ClampedArray]"]=No["[object Uint16Array]"]=No["[object Uint32Array]"]=!0,No["[object Error]"]=No[xo]=No["[object WeakMap]"]=!1,Wo.prototype.add=Wo.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Wo.prototype.has=function(t){return this.__data__.has(t)};var Bo,Ho=(Bo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(t){return null==Bo?void 0:Bo[t]}),Qo=/[&<>"']/g,Go=RegExp(Qo.source),Yo=Object.prototype,Jo=Yo.hasOwnProperty;function Zo(t,e,n,r){return void 0===t||Mi(t,Yo[n])&&!Jo.call(r,n)?e:t}var Ko={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function Xo(t){return"\\"+Ko[t]}var ta=/<%=([\s\S]+?)%>/g,ea={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:ta,variable:"",imports:{_:{escape:function(t){return(t=ws(t))&&Go.test(t)?t.replace(Qo,Ho):t}}}},na=/\b__p \+= '';/g,ra=/\b(__p \+=) '' \+/g,ia=/(__e\(.*?\)|\b__t\)) \+\n'';/g,sa=/[()=,{}\[\]\/\s]/,oa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,aa=/($^)/,ca=/['\n\r\u2028\u2029\\]/g,ua=Object.prototype.hasOwnProperty;function la(t,e,n){var r=ea.imports._.templateSettings||ea;t=ws(t),e=us({},e,r,Zo);var i,s,o=us({},e.imports,r.imports,Zo),a=ss(o),c=function(t,e){return Fr(e,(function(e){return t[e]}))}(o,a),u=0,l=e.interpolate||aa,h="__p += '",d=RegExp((e.escape||aa).source+"|"+l.source+"|"+(l===ta?oa:aa).source+"|"+(e.evaluate||aa).source+"|$","g"),f=ua.call(e,"sourceURL")?"//# sourceURL="+(e.sourceURL+"").replace(/\s/g," ")+"\n":"";t.replace(d,(function(e,n,r,o,a,c){return r||(r=o),h+=t.slice(u,c).replace(ca,Xo),n&&(i=!0,h+="' +\n__e("+n+") +\n'"),a&&(s=!0,h+="';\n"+a+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=c+e.length,e})),h+="';\n";var p=ua.call(e,"variable")&&e.variable;if(p){if(sa.test(p))throw new Error("Invalid `variable` option passed into `_.template`")}else h="with (obj) {\n"+h+"\n}\n";h=(s?h.replace(na,""):h).replace(ra,"$1").replace(ia,"$1;"),h="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=ks((function(){return Function(a,f+"return "+h).apply(void 0,c)}));if(g.source=h,Ps(g))throw g;return g}var ha=Bs&&1/Vo(new Bs([,-0]))[1]==1/0?function(t){return new Bs(t)}:function(){},da=Ii((function(t){return function(t,e,n){var r=-1,i=_i,s=t.length,o=!0,a=[],c=a;if(s>=200){var u=ha(t);if(u)return Vo(u);o=!1,i=Fo,c=new Wo}else c=a;t:for(;++r<s;){var l=t[r],h=l;if(l=0!==l?l:0,o&&h==h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}(function(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Os),i||(i=[]);++s<o;){var a=t[s];n(a)&&js(i,a)}return i}(t,0,qo))}));class fa{}class pa extends fa{data={};event=(()=>new j.EventEmitter)();constructor(t){super(),this.data=t}update(t,e){e?Jn(e,t,this.data):this.data=t;const n={updateData:t,path:e??""};e&&this.event.emit(e,n),this.event.emit("",n)}on(t,e){this.event.on(t,e)}off(t,e){this.event.off(t,e)}getData(t){return t?Yn(t,this.data):this.data}destroy(){}}class ga extends _{isInit=!1;app;mockData;#t="base";#e;#n;#r;#i=[];#s=[];constructor(t){super(),this.#e=t.schema.id,this.#n=t.schema,this.app=t.app,this.setFields(t.schema.fields),this.setMethods(t.schema.methods||[]);let e=t.initialData;const n=t.ObservedDataClass||pa;if("editor"===this.app.platform)this.mockData=t.schema.mocks?.find((t=>t.useInEditor))?.data||this.getDefaultData(),e=this.mockData;else if("boolean"==typeof t.useMock&&t.useMock)this.mockData=t.schema.mocks?.find((t=>t.enable))?.data||this.getDefaultData(),e=this.mockData;else{if(t.initialData)return this.#r=new n(t.initialData??{}),void(this.isInit=!0);e=this.getDefaultData()}this.#r=new n(e??{})}get id(){return this.#e}get type(){return this.#t}get schema(){return this.#n}get fields(){return this.#i}get methods(){return this.#s}setFields(t){this.#i=t}setMethods(t){this.#s=t}get data(){return this.#r.getData("")}setData(t,e){this.#r.update(t,e);const n={updateData:t,path:e};this.emit("change",n)}setValue(t,e){return this.setData(e,t)}onDataChange(t,e){this.#r.on(t,e)}offDataChange(t,e){this.#r.off(t,e)}getDefaultData(){return rr(this.#i)}async init(){this.isInit=!0}destroy(){this.#i=[],this.removeAllListeners(),this.#r.destroy()}}const ya=t=>Object.entries(t).reduce(((t,[e,n])=>{let r=n;return"object"==typeof n&&(r=JSON.stringify(n)),void 0!==n?`${t}${t?"&":""}${globalThis.encodeURIComponent(e)}=${globalThis.encodeURIComponent(`${r}`)}`:t}),""),ba=async t=>{const{url:e,method:n="GET",headers:r={},params:i={},data:s={},...o}=t,a=ya(i);let c=JSON.stringify(s);return r["Content-Type"]?.includes("application/x-www-form-urlencoded")&&(c=ya(s)),(await globalThis.fetch(a?`${e}?${a}`:e,{method:n,headers:r,body:"GET"===n?void 0:c,...o})).json()},va=(t,e)=>{let n=!0;for(const{op:r,value:i,range:s,field:o}of t){const[t,...a]=o,c=e[t];if(!c||!a.length)break;const u=Yn(a.join("."),c);if(!nr(r,u,i,s)){n=!1;break}}return n},ma=(t,e)=>{if(!t.displayConds||!Array.isArray(t.displayConds)||!t.displayConds.length)return!0;for(const{cond:n}of t.displayConds)if(n&&va(n,e))return!0;return!1},wa=(t,e)=>{if(Gn(t)||(t=>!!t&&Boolean(t.type?.toLowerCase()===Fn.PAGE_FRAGMENT))(t)){const n=e.items?.findIndex((e=>e.id===t.id));e.items.splice(n,1,t)}else Xn(t,e.items)},ja=(t,e)=>"string"==typeof t?la(t)(e):t?.isBindDataSource&&t.dataSourceId?e[t.dataSourceId]:t?.isBindDataSourceField&&t.dataSourceId&&"string"==typeof t.template?la(t.template)(e[t.dataSourceId]):Array.isArray(t)&&"string"==typeof t[0]?((t,e)=>{const[n,...r]=t,i=n.indexOf(ir);if(i>-1){const s=e[n.substring(i+10)];return s?Yn(r.join("."),s):t}return t})(t,e):t,_a=(t,e,n,r=[],i,s=!1)=>{const o=new ur;o.addTarget(new ar({id:n,type:"data-source",isTarget:(t,e)=>!`${t}`.startsWith(tr)&&(((t,e)=>"string"==typeof t&&t.includes(`${e}`)&&/\$\{([\s\S]+?)\}/.test(t))(e,n)||((t,e)=>{if(!Array.isArray(t)||"string"!=typeof t[0])return!1;const[n]=t,r=n.indexOf(ir);return-1!==r&&n.substring(r+10)===e})(e,n))})),o.addTarget(new ar({id:n,type:"cond",isTarget:(t,e)=>!(!Array.isArray(e)||e[0]!==n||!`${t}`.startsWith("displayConds"))})),o.collect(e,{},!0);const{deps:a}=o.getTarget(n,"data-source"),{deps:c}=o.getTarget(n,"cond");return Object.keys(a).length||Object.keys(c).length?e.map((e=>Oa({itemData:t,data:i,dsId:n,keys:r,inEditor:s,condDeps:c,item:e,deps:a}))):e},Oa=({itemData:t,data:e,dsId:n,keys:r,inEditor:i,condDeps:s,item:o,deps:a})=>{const{items:c,...u}=o,l=Uo(u);c&&!o.iteratorData&&(l.items=Array.isArray(c)?c.map((o=>Oa({itemData:t,data:e,dsId:n,keys:r,inEditor:i,condDeps:s,item:o,deps:a}))):c),Array.isArray(c)&&c.length?o.iteratorData?l.items=c:l.items=c.map((o=>Oa({itemData:t,data:e,dsId:n,keys:r,inEditor:i,condDeps:s,item:o,deps:a}))):l.items=c;const h=((t,e,n=[],r={})=>{const i={...r,[e]:{}};return n.reduce(((e,r,i)=>(e[r]=i===n.length-1?t:{},e[r])),i[e]),i})(t,n,r,e);return s[l.id]?.keys.length&&!i&&(l.condResult=ma(l,h)),a[l.id]?.keys.length?er((t=>ja(t,h)),l,{[n]:a},n):l};class Sa extends _{static dataSourceClassMap=(()=>new Map)();static ObservedDataClass=(()=>pa)();static register(t,e){Sa.dataSourceClassMap.set(t,e)}static registe(t,e){Sa.register(t,e)}static getDataSourceClass(t){return Sa.dataSourceClassMap.get(t)}static registerObservedData(t){Sa.ObservedDataClass=t}app;dataSourceMap=(()=>new Map)();data={};useMock=!1;constructor({app:t,useMock:e,initialData:n}){super(),this.app=t,this.useMock=e,n&&(this.data=n),t.dsl?.dataSources?.forEach((t=>{this.addDataSource(t)}));const r=Array.from(this.dataSourceMap);"function"==typeof Promise.allSettled?Promise.allSettled(r.map((([,t])=>this.init(t)))).then((t=>{const e={},n={};t.forEach(((t,i)=>{const s=r[i][0];"fulfilled"===t.status?e[s]=this.data[s]:"rejected"===t.status&&(n[s]=t.reason)})),this.emit("init",e,n)})):Promise.all(r.map((([,t])=>this.init(t)))).then((()=>{this.emit("init",this.data)})).catch((()=>{this.emit("init",this.data)}))}async init(t){if(t.isInit)return;if(this.app.jsEngine&&t.schema.disabledInitInJsEngine?.includes(this.app.jsEngine))return;const e=[],n=[];t.methods.forEach((t=>{"function"==typeof t.content&&("beforeInit"===t.timing&&e.push(t.content),"afterInit"===t.timing&&n.push(t.content))}));for(const r of e)await r({params:{},dataSource:t,app:this.app});await t.init();for(const r of n)await r({params:{},dataSource:t,app:this.app})}get(t){return this.dataSourceMap.get(t)}async addDataSource(t){if(!t)return;const e=new(Sa.dataSourceClassMap.get(t.type)||ga)({app:this.app,schema:t,request:this.app.request,useMock:this.useMock,initialData:this.data[t.id],ObservedDataClass:Sa.ObservedDataClass});this.dataSourceMap.set(t.id,e),this.data[e.id]=e.data,e.on("change",(t=>{this.setData(e,t)}))}setData(t,e){this.data[t.id]=t.data,this.emit("change",t.id,e)}removeDataSource(t){this.get(t)?.destroy(),delete this.data[t],this.dataSourceMap.delete(t)}updateSchema(t){t.forEach((t=>{if(!this.get(t.id))return;this.removeDataSource(t.id),this.addDataSource(t);const e=this.get(t.id);e&&this.init(e)}))}compiledNode({items:t,...e},n,r=!1){const i=Uo(e);return t&&(i.items=Array.isArray(t)&&r?t.map((t=>this.compiledNode(t,n,r))):t),!1===e.condResult||!1===e.visible?i:er((t=>ja(t,this.data)),i,this.app.dsl?.dataSourceDeps||{},n)}compliedConds(t){return ma(t,this.data)}compliedIteratorItemConds(t,e=[]){return((t=[],e)=>{if(!t||!Array.isArray(t)||!t.length)return!0;for(const{cond:n}of t){if(!n)continue;let t=!0;for(const{op:r,value:i,range:s,field:o}of n){const n=Yn(o.join("."),e);if(!nr(r,n,i,s)){t=!1;break}}if(t)return t}return!1})(e,t)}compliedIteratorItems(t,e,n=[]){const[r,...i]=n;return this.get(r)?_a(t,e,r,i,this.data,"editor"===this.app.platform):e}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach((t=>{t.destroy()})),this.dataSourceMap.clear()}onDataChange(t,e,n){return this.get(t)?.onDataChange(e,n)}offDataChange(t,e,n){return this.get(t)?.offDataChange(e,n)}}Sa.register("http",class extends ga{isLoading=!1;error;httpOptions;#o;#a=[];#c=[];#t="http";constructor(t){const{options:e}=t.schema;super(t),this.httpOptions=e,"function"==typeof t.request?this.#o=t.request:"function"==typeof globalThis.fetch&&(this.#o=ba),this.methods.forEach((t=>{"function"==typeof t.content&&("beforeRequest"===t.timing&&this.#a.push(t.content),"afterRequest"===t.timing&&this.#c.push(t.content))}))}get type(){return this.#t}async init(){this.schema.autoFetch&&await this.request(this.httpOptions),super.init()}async request(t={}){this.isLoading=!0;let e={...this.httpOptions,...t};try{for(const n of this.#a)await n({options:e,params:{},dataSource:this,app:this.app});"function"==typeof this.schema.beforeRequest&&(e=this.schema.beforeRequest(e,{app:this.app,dataSource:this}));let t=this.mockData?this.mockData:await(this.#o?.(e));for(const n of this.#c)await n({res:t,options:e,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.afterResponse&&(t=this.schema.afterResponse(t,{app:this.app,dataSource:this,options:e})),this.schema.responseOptions?.dataPath){const e=Yn(this.schema.responseOptions.dataPath,t);this.setData(e)}else this.setData(t);this.error=void 0}catch(n){this.error={msg:n.message},this.emit("error",n)}this.isLoading=!1}get(t){return this.request({...t,method:"GET"})}post(t){return this.request({...t,method:"POST"})}});class Da{isIos=!1;isIphone=!1;isIpad=!1;isAndroid=!1;isAndroidPad=!1;isMac=!1;isWin=!1;isMqq=!1;isWechat=!1;isWeb=!1;isOpenHarmony=!1;constructor(t=globalThis.navigator.userAgent,e={}){this.isIphone=t.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(t),this.isIos=this.isIphone||this.isIpad,this.isAndroid=t.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&t.indexOf("Mobile")<0,this.isMac=t.indexOf("Macintosh")>=0,this.isWin=t.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(t),this.isWechat=t.indexOf("MicroMessenger")>=0&&t.indexOf("wxwork")<0,this.isOpenHarmony=t.includes("OpenHarmony"),this.isWeb=!(this.isIos||this.isAndroid||this.isOpenHarmony||/(WebOS|BlackBerry)/.test(t)),Object.entries(e).forEach((([t,e])=>{this[t]=e}))}}const Aa="magic:common:events:",Ma="magic:common:actions:",$a="show",Ea="hide",Ca="scrollIntoView",Ia="scrollToTop",La=(t,e)=>{if(!t)return!1;if(!t.id)return La(t.parentElement,e);const n=e.page?.getNode(t.id);return n||!1},Pa=(t,e,n)=>{const r=La(n.target,t);var i;r&&t.emit((i=e).startsWith(Aa)?i:`${Aa}${i}`,r)};class ka{designWidth=375;tid;constructor(t){"complete"===globalThis.document.readyState?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),void 0!==t?.designWidth&&this.setDesignWidth(t.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(t){this.designWidth=t,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:t}=document.documentElement.getBoundingClientRect(),e=t/(this.designWidth/100);globalThis.document.documentElement.style.fontSize=`${e}px`,globalThis.document.documentElement.style.fontSize=`${this.correctRem(e)}px`}correctRem(t){const{document:e}=globalThis,n=e.createElement("div");n.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",e.documentElement.appendChild(n);const r=n.offsetWidth;return e.documentElement.removeChild(n),Math.abs(r-t)>1?t**2/r:t}resizeHandler=()=>{clearTimeout(this.tid),this.tid=setTimeout((()=>{this.refreshRem()}),300)};pageshowHandler=t=>{t.persisted&&this.resizeHandler()}}class xa{data={};set(t,e){this.data[t]=e}get(t){return this.data[t]}}class Ta extends j.EventEmitter{data;style;events=[];instance;page;parent;app;store=(()=>new xa)();constructor(t){super(),this.page=t.page,this.parent=t.parent,this.app=t.app,this.setData(t.config),this.listenLifeSafe()}setData(t){this.data=t;const{events:e,style:n}=t;this.events=e||[],this.style=n||{},this.emit("update-data")}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",(async t=>{this.once("destroy",(()=>{this.instance=null,"function"==typeof this.data.destroy&&this.data.destroy(this),this.listenLifeSafe()})),this.instance=t,await this.runHookCode("created")})),this.once("mounted",(async t=>{this.instance=t;const e=this.app.eventQueueMap[t.config.id]||[];for(let n=e.shift();n;n=e.shift())this.app.compActionHandler(n.eventConfig,n.fromCpt,n.args);await this.runHookCode("mounted")}))}async runHookCode(t){if("function"==typeof this.data[t])return void(await this.data[t](this));const e=this.data[t];if(e?.hookType===qn.CODE)for(const n of e.hookData){const{codeType:t=Bn.CODE,codeId:e,params:r={}}=n;let i;const s={app:this.app,params:r};if(t===Bn.CODE&&"string"==typeof e&&this.app.codeDsl?.[e])i=this.app.codeDsl[e].content;else if(t===Bn.DATA_SOURCE_METHOD&&Array.isArray(e)&&e.length>1){const t=this.app.dataSourceManager?.get(e[0]);i=t?.methods.find((t=>t.name===e[1]))?.content,s.dataSource=t}i&&"function"==typeof i&&await i(s)}}}class Ra extends Ta{nodes=(()=>new Map)();constructor(t){super(t),this.setNode(t.config.id,this),t.config.items.forEach((t=>{this.initNode(t,this)}))}initNode(t,e){const n=new Ta({config:t,parent:e,page:this,app:this.app});if(this.setNode(t.id,n),"page-fragment-container"===t.type&&t.pageFragmentId){const e=this.app.dsl?.items?.find((e=>e.id===t.pageFragmentId));e&&(t.items=[e])}t.items?.forEach((t=>{this.initNode(t,n)}))}getNode(t){return this.nodes.get(t)}setNode(t,e){this.nodes.set(t,e)}deleteNode(t){this.nodes.delete(t)}destroy(){super.destroy(),this.nodes.clear()}}const Na=(t,e)=>{if(!t)return{};let n={};const r={};n="string"==typeof t?(t=>{if("string"!=typeof t)return t;const e={};return t.split(";").forEach((t=>{if(!t)return;const n=t.split(":");let r=n.shift(),i=n.join(":");r&&(r=r.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/^\s*/,"").replace(/\s*$/,""),r=r.split("-").map(((t,e)=>e>0?`${t[0].toUpperCase()}${t.substr(1)}`:t)).join(""),e[r]=i)})),e})(t):{...t};const i="hippy"===e,s=["zIndex","opacity","fontWeight"];return Object.entries(n).forEach((([t,n])=>{"scale"===t&&!r.transform&&i?r.transform=[{scale:n}]:"backgroundImage"!==t||i?"transform"===t&&"string"!=typeof n?r[t]=((t,e)=>{if(!t)return[];const n=Object.entries(t).map((([t,n])=>n.trim()?("rotate"===t&&(t=>/^(-?\d+)(\.\d+)?$/.test(t))(n)&&(n=`${n}deg`),"hippy"!==e?`${t}(${n})`:{[t]:n}):""));if("hippy"===e)return n;const r=n.join(" ");return r.trim()?r:"none"})(n,e):!s.includes(t)&&n&&/^[-]?[0-9]*[.]?[0-9]*$/.test(n)?r[t]=i?n:n/100+"rem":r[t]=n:n&&(r[t]=(t=>!t||/^url/.test(t)||/^linear-gradient/.test(t)?t:`url(${t})`)(n))})),r};class za extends j.EventEmitter{env=(()=>new Da)();dsl;codeDsl;dataSourceManager;page;useMock=!1;platform="mobile";jsEngine="browser";request;components=(()=>new Map)();eventQueueMap={};transformStyle;flexible;eventList=(()=>new Map)();dataSourceEventList=(()=>new Map)();constructor(t){var e;super(),this.setEnv(t.ua),this.codeDsl=t.config?.codeBlocks,t.platform&&(this.platform=t.platform),t.jsEngine&&(this.jsEngine=t.jsEngine),"boolean"==typeof t.useMock&&(this.useMock=t.useMock),"browser"===this.jsEngine&&(this.flexible=new ka({designWidth:t.designWidth})),this.transformStyle=t.transformStyle||(t=>Na(t,this.jsEngine)),t.request&&(this.request=t.request),t.config&&this.setConfig(t.config,t.curPage),"browser"===(e=this).jsEngine&&(window.document.body.addEventListener("click",(t=>{Pa(e,"click",t)})),window.document.body.addEventListener("click",(t=>{Pa(e,"click:capture",t)}),!0))}setEnv(t){this.env=new Da(t)}setDesignWidth(t){this.flexible?.setDesignWidth(t)}setConfig(t,e){this.dsl=t,!e&&t.items.length&&(e=t.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=((t,e,n)=>{const{dsl:r,platform:i}=t;if(!r?.dataSources)return;const s=new Sa({app:t,useMock:e,initialData:n});return r.dataSources&&r.dataSourceCondDeps&&"editor"!==i&&Zn(Kn(r.dataSourceCondDeps),r.items).forEach((t=>{t.condResult=s.compliedConds(t),wa(t,r)})),r.dataSources&&r.dataSourceDeps&&Zn(Kn(r.dataSourceDeps),r.items).forEach((t=>{wa(s.compiledNode(t),r)})),"nodejs"!==t.jsEngine&&s.on("change",((e,n)=>{const i=r.dataSourceDeps?.[e]||{},o=r.dataSourceCondDeps?.[e]||{},a=da([...Object.keys(o),...Object.keys(i)]),c=t.page?.data&&"editor"!==t.platform?[t.page.data]:r.items;s.emit("update-data",Zn(a,c).map((e=>{"editor"!==t.platform&&(e.condResult=s.compliedConds(e));const n=s.compiledNode(e);if("function"==typeof t.page?.setData)if(Gn(n))t.page.setData(n);else{const r=t.page.getNode(e.id);r?.setData(n)}return n})),e,n)})),s})(this,this.useMock),this.codeDsl=t.codeBlocks,this.setPage(e||this.page?.data?.id)}addPage(){console.info("addPage 已经弃用")}setPage(t){const e=this.dsl?.items.find((e=>`${e.id}`==`${t}`));if(!e)return this.page&&(this.page.destroy(),this.page=void 0),void super.emit("page-change");e!==this.page?.data&&(this.page&&this.page.destroy(),this.page=new Ra({config:e,app:this}),super.emit("page-change",this.page),this.bindEvents())}deletePage(){this.page=void 0}getPage(t){return t?this.page&&`${this.page.data.id}`==`${t}`?this.page:void 0:this.page}registerComponent(t,e){this.components.set(t,e)}unregisterComponent(t){this.components.delete(t)}resolveComponent(t){return this.components.get(t)}bindEvents(){if(Array.from(this.eventList.keys()).forEach((t=>{const e=this.eventList.get(t);e&&this.off(e,t)})),this.eventList.clear(),this.page){for(const[,t]of this.page.nodes)t.events?.forEach(((e,n)=>{let r=`${e.name}_${t.data.id}`,i=(t,...e)=>{this.eventHandler(n,t,e)};const s=e.name.split(".");s.length>1&&(r=`${s[1]}_${s[0]}`,i=(e,...r)=>{this.eventHandler(n,t,r)}),this.eventList.set(i,r),this.on(r,i)}));this.bindDataSourceEvents()}}emit(t,...e){const[n,...r]=e;return n instanceof Ta&&n?.data?.id?super.emit(`${String(t)}_${n.data.id}`,n,...r):super.emit(t,...e)}async codeActionHandler(t,e){const{codeId:n="",params:r={}}=t;if(!n||function(t){if(null==t)return!0;if(Ot(t)&&(z(t)||"string"==typeof t||"function"==typeof t.splice||kt(t)||Ft(t)||Ct(t)))return!t.length;var e=Je(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(Dt(t))return!Gt(t).length;for(var n in t)if(Un.call(t,n))return!1;return!0}(this.codeDsl))return;const i=this.codeDsl?.[n]?.content;"function"==typeof i&&await i({app:this,params:r,eventParams:e})}async compActionHandler(t,e,n){if(!this.page)throw new Error("当前没有页面");let{method:r,to:i}=t;z(r)&&([i,r]=r);const s=this.page.getNode(i);if(!s)throw`ID为${i}的组件不存在`;if((t=>t.startsWith(Ma))(r))return((t,e)=>{const{instance:n}=e;if(n)switch(t.replace(Ma,"")){case $a:n.show();break;case Ea:n.hide();break;case Ca:n.$el?.scrollIntoView({behavior:"smooth"});break;case Ia:window.scrollTo({top:0,behavior:"smooth"})}})(r,s);s.instance?"function"==typeof s.instance[r]&&await s.instance[r](e,...n):this.addEventToMap({eventConfig:t,fromCpt:e,args:n})}async dataSourceActionHandler(t,e){const{dataSourceMethod:n=[],params:r={}}=t,[i,s]=n;if(!i||!s)return;const o=this.dataSourceManager?.get(i);if(!o)return;const a=(o.methods||[]).find((t=>t.name===s));a&&"function"==typeof a.content&&await a.content({app:this,params:r,dataSource:o,eventParams:e})}destroy(){this.removeAllListeners(),this.page=void 0,this.flexible?.destroy(),this.flexible=void 0}bindDataSourceEvents(){"editor"!==this.platform&&(Array.from(this.dataSourceEventList.keys()).forEach((t=>{const e=this.dataSourceEventList.get(t);Array.from(e.keys()).forEach((n=>{const[r,...i]=n.split(".");r===sr?this.dataSourceManager?.offDataChange(t,i.join("."),e.get(n)):this.dataSourceManager?.get(t)?.off(r,e.get(n))}))})),(this.dsl?.dataSources||[]).forEach((t=>{const e=this.dataSourceEventList.get(t.id)??new Map;(t.events||[]).forEach((n=>{const[r,...i]=n.name?.split(".")||[];if(!r)return;const s=(...e)=>{this.eventHandler(n,this.dataSourceManager?.get(t.id),e)};e.set(n.name,s),r===sr?this.dataSourceManager?.onDataChange(t.id,i.join("."),s):this.dataSourceManager?.get(t.id)?.on(r,s)})),this.dataSourceEventList.set(t.id,e)})))}async actionHandler(t,e,n){t.actionType===Vn.COMP?await this.compActionHandler(t,e,n):t.actionType===Vn.CODE?await this.codeActionHandler(t,n):t.actionType===Vn.DATA_SOURCE&&await this.dataSourceActionHandler(t,n)}async eventHandler(t,e,n){const r="number"==typeof t?e.events[t]:t;if(zn(r,"actions")){const{actions:i}=r;for(let r=0;r<i.length;r++)if("number"==typeof t){const i=e.events[t].actions[r];this.actionHandler(i,e,n)}else this.actionHandler(i[r],e,n)}else await this.compActionHandler(r,e,n)}addEventToMap(t){this.eventQueueMap[t.eventConfig.to]?this.eventQueueMap[t.eventConfig.to].push(t):this.eventQueueMap[t.eventConfig.to]=[t]}}const Ua=(t,e=window)=>{const n=VueDemi.ref(),r=VueDemi.ref(),i=VueDemi.ref(),s=VueDemi.computed((()=>n.value?.items?.find((t=>t.id===r.value))||n.value?.items?.[0]));return VueDemi.watch(s,(async()=>{await VueDemi.nextTick();const t=document.querySelector(".magic-ui-page");t&&e.magic?.onPageElUpdate(t)})),e.magic?.onRuntimeReady({getApp:()=>t,updateRootConfig(e){n.value=e,t?.setConfig(e,r.value)},updatePageId(e){r.value=e,t?.setPage(e)},select(e){i.value=e,t?.getPage(e)&&this.updatePageId?.(e);const n=document.getElementById(`${e}`);return n||VueDemi.nextTick().then((()=>document.getElementById(`${e}`)))},add({config:e,parentId:r}){if(!n.value)throw new Error("error");if(!i.value)throw new Error("error");if(!r)throw new Error("error");const s=Hn(r,[n.value]).pop();if(!s)throw new Error("未找到父节点");if("page"!==e.type){const n=t?.page?.getNode(s.id);n&&t?.page?.initNode(e,n)}if(s.id!==i.value){const t=s.items?.findIndex((t=>t.id===i.value));s.items?.splice(t+1,0,e)}else s.items?.push(e)},update({config:e,parentId:r}){if(!n.value||!t)throw new Error("error");const i=t.dataSourceManager?.compiledNode(e,void 0,!0)||e;Xn(VueDemi.reactive(i),[n.value],r);const s=t.page?.getNode(e.id);s&&s.setData(i),t.page?.data.id===e.id&&t.page.setData(i)},remove({id:e,parentId:r}){if(!n.value)throw new Error("error");const i=Hn(e,[n.value]).pop();if(!i)throw new Error("未找到目标元素");const s=Hn(r,[n.value]).pop();if(!s)throw new Error("未找到父元素");"page"===i.type?t?.deletePage():t?.page?.deleteNode(i.id);const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1)}}),{pageConfig:s}},Wa=Vue.defineComponent({__name:"App",setup(t){const e=Vue.inject("app"),{pageConfig:n}=Ua(e);return(t,e)=>{const r=Vue.resolveComponent("magic-ui-page");return Vue.unref(n)?(Vue.openBlock(),Vue.createBlock(r,{key:Vue.unref(n).id,config:Vue.unref(n)},null,8,["config"])):Vue.createCommentVNode("",!0)}}});Sa.registerObservedData(class extends fa{state;subscribers=(()=>new Map)();constructor(t){super(),this.state=new Ar(t)}update=(t,e)=>{this.state?.update(e??"",t)};on=(t,e)=>{const n=this.state.subscribe(t,(t=>{let e=0;return(...n)=>{if(0!==e)return t(...n);e+=1}})(e)),r=this.subscribers.get(t)??new Map;r.set(e,n),this.subscribers.set(t,r)};off=(t,e)=>{const n=this.subscribers.get(t);n&&(n.get(e)?.(),n.delete(e))};getData=t=>this.state?this.state?.get(t):{};destroy=()=>{this.subscribers.forEach((t=>{t.forEach((t=>t()))}))}}),Promise.all([r((()=>e.import("./comp-entry-legacy-ClCd3lyo.js"))),r((()=>e.import("./plugin-entry-legacy-Du67ziIl.js"))),r((()=>e.import("./datasource-entry-legacy-Du67ziIl.js")))]).then((([t,e,n])=>{const r=Vue.createApp(Wa),i=new za({ua:window.navigator.userAgent,platform:"editor"});i.env.isWeb&&i.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(t.default).forEach((([t,e])=>{r.component(`magic-ui-${t}`,e)})),Object.entries(n.default).forEach((([t,e])=>{Sa.register(t,e)})),Object.values(e.default).forEach((t=>{r.use(t,{app:i})})),window.appInstance=i,r.config.globalProperties.app=i,r.provide("app",i),r.mount("#app")}))}}}));
//# sourceMappingURL=index-legacy-ZqCa2gSA.js.map
